import{a as ui}from"./chunk-URMLSJLD.js";import{Ja as $l,a as B,b as le,c as go,j as zl,m as jl,u as _o}from"./chunk-MRY22VQC.js";var Gl=()=>{};var Hl=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Xm=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Ql={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,y=(o&3)<<4|u>>4,T=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(T=64)),r.push(t[p],t[y],t[T],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Hl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Xm(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let y=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||y==null)throw new Io;let T=o<<2|u>>4;if(r.push(T),d!==64){let R=u<<4&240|d>>2;if(r.push(R),y!==64){let N=d<<6&192|y;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Io=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Zm=function(n){let e=Hl(n);return Ql.encodeByteArray(e,!0)},ur=function(n){return Zm(n).replace(/\./g,"")},hi=function(n){try{return Ql.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Jl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var eg=()=>Jl().__FIREBASE_DEFAULTS__,tg=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ng=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&hi(n[1]);return e&&JSON.parse(e)},di=()=>{try{return Gl()||eg()||tg()||ng()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Eo=n=>di()?.emulatorHosts?.[n],Yl=n=>{let e=Eo(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},To=()=>di()?.config,vo=n=>di()?.[`_${n}`];var li=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Tt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function fi(n){return(await fetch(n,{credentials:"include"})).ok}function Xl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=B({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ur(JSON.stringify(t)),ur(JSON.stringify(a)),""].join(".")}var cr={};function rg(){let n={prod:[],emulator:[]};for(let e of Object.keys(cr))cr[e]?n.emulator.push(e):n.prod.push(e);return n}function ig(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Wl=!1;function pi(n,e){if(typeof window>"u"||typeof document>"u"||!Tt(window.location.host)||cr[n]===e||cr[n]||Wl)return;cr[n]=e;function t(T){return`__firebase__banner__${T}`}let r="__firebase__banner",o=rg().prod.length>0;function a(){let T=document.getElementById(r);T&&T.remove()}function u(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function h(T,R){T.setAttribute("width","24"),T.setAttribute("id",R),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function d(){let T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{Wl=!0,a()},T}function p(T,R){T.setAttribute("id",R),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function y(){let T=ig(r),R=t("text"),N=document.getElementById(R)||document.createElement("span"),O=t("learnmore"),D=document.getElementById(O)||document.createElement("a"),$=t("preprendIcon"),K=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){let J=T.element;u(J),p(D,O);let we=d();h(K,$),J.append(K,N,D,we),document.body.appendChild(J)}o?(N.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function he(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Zl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(he())}function sg(){let n=di()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function eh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function mi(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function th(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function nh(){let n=he();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function rh(){return!sg()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lr(){try{return typeof indexedDB=="object"}catch{return!1}}function gi(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}function ih(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var og="FirebaseError",ge=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=og,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,De.prototype.create)}},De=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?ag(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new ge(i,u,r)}};function ag(n,e){return n.replace(cg,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var cg=/\{\$([^}]+)}/g;function sh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ne(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(Kl(o)&&Kl(a)){if(!Ne(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Kl(n){return n!==null&&typeof n=="object"}function hr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function mn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function gn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function oh(n,e){let t=new wo(n,e);return t.subscribe.bind(t)}var wo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ug(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=yo),i.error===void 0&&(i.error=yo),i.complete===void 0&&(i.complete=yo);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function ug(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function yo(){}var lg=1e3,hg=2,dg=14400*1e3,fg=.5;function Ao(n,e=lg,t=hg){let r=e*Math.pow(t,n),i=Math.round(fg*r*(Math.random()-.5)*2);return Math.min(dg,r+i)}function ne(n){return n&&n._delegate?n._delegate:n}var de=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ft="[DEFAULT]";var bo=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new li;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(mg(e))try{this.getOrInitializeService({instanceIdentifier:Ft})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Ft){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ft){return this.instances.has(e)}getOptions(e=Ft){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:pg(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ft){return this.component?this.component.multipleInstances?e:Ft:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function pg(n){return n===Ft?void 0:n}function mg(n){return n.instantiationMode==="EAGER"}var _i=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new bo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var gg=[],z=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(z||{}),_g={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},yg=z.INFO,Ig={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},wg=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=Ig[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ze=class{constructor(e){this.name=e,this._logLevel=yg,this._logHandler=wg,this._userLogHandler=null,gg.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_g[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}};var Eg=(n,e)=>e.some(t=>n instanceof t),ah,ch;function Tg(){return ah||(ah=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vg(){return ch||(ch=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var uh=new WeakMap,Ro=new WeakMap,lh=new WeakMap,So=new WeakMap,Co=new WeakMap;function Ag(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(je(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&uh.set(t,n)}).catch(()=>{}),Co.set(e,n),e}function bg(n){if(Ro.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Ro.set(n,e)}var Po={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ro.get(n);if(e==="objectStoreNames")return n.objectStoreNames||lh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return je(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function hh(n){Po=n(Po)}function Sg(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(yi(this),e,...t);return lh.set(r,e.sort?e.sort():[e]),je(r)}:vg().includes(n)?function(...e){return n.apply(yi(this),e),je(uh.get(this))}:function(...e){return je(n.apply(yi(this),e))}}function Rg(n){return typeof n=="function"?Sg(n):(n instanceof IDBTransaction&&bg(n),Eg(n,Tg())?new Proxy(n,Po):n)}function je(n){if(n instanceof IDBRequest)return Ag(n);if(So.has(n))return So.get(n);let e=Rg(n);return e!==n&&(So.set(n,e),Co.set(e,n)),e}var yi=n=>Co.get(n);function Ii(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=je(a);return r&&a.addEventListener("upgradeneeded",h=>{r(je(a.result),h.oldVersion,h.newVersion,je(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var Pg=["get","getKey","getAll","getAllKeys","count"],Cg=["put","add","delete","clear"],ko=new Map;function dh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ko.get(e))return ko.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Cg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Pg.includes(t)))return;let o=async function(a,...u){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),i&&h.done]))[0]};return ko.set(e,o),o}hh(n=>le(B({},n),{get:(e,t,r)=>dh(e,t)||n.get(e,t,r),has:(e,t)=>!!dh(e,t)||n.has(e,t)}));var No=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(kg(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function kg(n){return n.getComponent()?.type==="VERSION"}var Vo="@firebase/app",fh="0.14.8";var et=new ze("@firebase/app"),Dg="@firebase/app-compat",Ng="@firebase/analytics-compat",Vg="@firebase/analytics",Og="@firebase/app-check-compat",xg="@firebase/app-check",Lg="@firebase/auth",Mg="@firebase/auth-compat",Fg="@firebase/database",Ug="@firebase/data-connect",qg="@firebase/database-compat",Bg="@firebase/functions",zg="@firebase/functions-compat",jg="@firebase/installations",$g="@firebase/installations-compat",Gg="@firebase/messaging",Wg="@firebase/messaging-compat",Kg="@firebase/performance",Hg="@firebase/performance-compat",Qg="@firebase/remote-config",Jg="@firebase/remote-config-compat",Yg="@firebase/storage",Xg="@firebase/storage-compat",Zg="@firebase/firestore",e_="@firebase/ai",t_="@firebase/firestore-compat",n_="firebase",r_="12.9.0";var Oo="[DEFAULT]",i_={[Vo]:"fire-core",[Dg]:"fire-core-compat",[Vg]:"fire-analytics",[Ng]:"fire-analytics-compat",[xg]:"fire-app-check",[Og]:"fire-app-check-compat",[Lg]:"fire-auth",[Mg]:"fire-auth-compat",[Fg]:"fire-rtdb",[Ug]:"fire-data-connect",[qg]:"fire-rtdb-compat",[Bg]:"fire-fn",[zg]:"fire-fn-compat",[jg]:"fire-iid",[$g]:"fire-iid-compat",[Gg]:"fire-fcm",[Wg]:"fire-fcm-compat",[Kg]:"fire-perf",[Hg]:"fire-perf-compat",[Qg]:"fire-rc",[Jg]:"fire-rc-compat",[Yg]:"fire-gcs",[Xg]:"fire-gcs-compat",[Zg]:"fire-fst",[t_]:"fire-fst-compat",[e_]:"fire-vertex","fire-js":"fire-js",[n_]:"fire-js-all"};var wi=new Map,s_=new Map,xo=new Map;function ph(n,e){try{n.container.addComponent(e)}catch(t){et.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Re(n){let e=n.name;if(xo.has(e))return et.debug(`There were multiple attempts to register component ${e}.`),!1;xo.set(e,n);for(let t of wi.values())ph(t,n);for(let t of s_.values())ph(t,n);return!0}function Me(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Pe(n){return n==null?!1:n.settings!==void 0}var o_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vt=new De("app","Firebase",o_);var Lo=class{constructor(e,t,r){this._isDeleted=!1,this._options=B({},e),this._config=B({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new de("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vt.create("app-deleted",{appName:this._name})}};var At=r_;function Uo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=B({name:Oo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw vt.create("bad-app-name",{appName:String(i)});if(t||(t=To()),!t)throw vt.create("no-options");let o=wi.get(i);if(o){if(Ne(t,o.options)&&Ne(r,o.config))return o;throw vt.create("duplicate-app",{appName:i})}let a=new _i(i);for(let h of xo.values())a.addComponent(h);let u=new Lo(t,r,a);return wi.set(i,u),u}function Ut(n=Oo){let e=wi.get(n);if(!e&&n===Oo&&To())return Uo();if(!e)throw vt.create("no-app",{appName:n});return e}function _e(n,e,t){let r=i_[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),et.warn(a.join(" "));return}Re(new de(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var a_="firebase-heartbeat-database",c_=1,dr="firebase-heartbeat-store",Do=null;function yh(){return Do||(Do=Ii(a_,c_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(dr)}catch(t){console.warn(t)}}}}).catch(n=>{throw vt.create("idb-open",{originalErrorMessage:n.message})})),Do}async function u_(n){try{let t=(await yh()).transaction(dr),r=await t.objectStore(dr).get(Ih(n));return await t.done,r}catch(e){if(e instanceof ge)et.warn(e.message);else{let t=vt.create("idb-get",{originalErrorMessage:e?.message});et.warn(t.message)}}}async function mh(n,e){try{let r=(await yh()).transaction(dr,"readwrite");await r.objectStore(dr).put(e,Ih(n)),await r.done}catch(t){if(t instanceof ge)et.warn(t.message);else{let r=vt.create("idb-set",{originalErrorMessage:t?.message});et.warn(r.message)}}}function Ih(n){return`${n.name}!${n.options.appId}`}var l_=1024,h_=30,Mo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Fo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=gh();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>h_){let i=f_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){et.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=gh(),{heartbeatsToSend:t,unsentEntries:r}=d_(this._heartbeatsCache.heartbeats),i=ur(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return et.warn(e),""}}};function gh(){return new Date().toISOString().substring(0,10)}function d_(n,e=l_){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),_h(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),_h(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Fo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lr()?gi().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await u_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let r=await this.read();return mh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let r=await this.read();return mh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}};function _h(n){return ur(JSON.stringify({version:2,heartbeats:n})).length}function f_(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function p_(n){Re(new de("platform-logger",e=>new No(e),"PRIVATE")),Re(new de("heartbeat",e=>new Mo(e),"PRIVATE")),_e(Vo,fh,n),_e(Vo,fh,"esm2020"),_e("fire-js","")}p_("");function xh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Lh=xh,Mh=new De("auth","Firebase",xh());var Si=new ze("@firebase/auth");function m_(n,...e){Si.logLevel<=z.WARN&&Si.warn(`Auth (${At}): ${n}`,...e)}function Ti(n,...e){Si.logLevel<=z.ERROR&&Si.error(`Auth (${At}): ${n}`,...e)}function Ge(n,...e){throw la(n,...e)}function qt(n,...e){return la(n,...e)}function Fh(n,e,t){let r=le(B({},Lh()),{[e]:t});return new De("auth","Firebase",r).create(e,{appName:n.name})}function rt(n){return Fh(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function la(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Mh.create(n,...e)}function M(n,e,...t){if(!n)throw la(e,...t)}function tt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ti(e),new Error(e)}function Rt(n,e){n||tt(e)}function jo(){return typeof self<"u"&&self.location?.href||""}function g_(){return wh()==="http:"||wh()==="https:"}function wh(){return typeof self<"u"&&self.location?.protocol||null}function __(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(g_()||mi()||"connection"in navigator)?navigator.onLine:!0}function y_(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Bt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rt(t>e,"Short delay should be less than long delay!"),this.isMobile=Zl()||th()}get(){return __()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function ha(n,e){Rt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Ri=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;tt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;tt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;tt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var I_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var w_=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],E_=new Bt(3e4,6e4);function Pt(n,e){return n.tenantId&&!e.tenantId?le(B({},e),{tenantId:n.tenantId}):e}async function it(n,e,t,r,i={}){return Uh(n,i,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});let u=hr(B({key:n.config.apiKey},a)).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);let d=B({method:e,headers:h},o);return eh()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Tt(n.emulatorConfig.host)&&(d.credentials="include"),Ri.fetch()(await qh(n,n.config.apiHost,t,u),d)})}async function Uh(n,e,t){n._canInitEmulator=!1;let r=B(B({},I_),e);try{let i=new $o(n),o=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=await o.json();if("needConfirmation"in a)throw Ei(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ei(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Ei(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Ei(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Fh(n,p,d);Ge(n,p)}}catch(i){if(i instanceof ge)throw i;Ge(n,"network-request-failed",{message:String(i)})}}async function wr(n,e,t,r,i={}){let o=await it(n,e,t,r,i);return"mfaPendingCredential"in o&&Ge(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function qh(n,e,t,r){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?ha(n.config,i):`${n.config.apiScheme}://${i}`;return w_.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function T_(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var $o=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(qt(this.auth,"network-request-failed")),E_.get())})}};function Ei(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=qt(n,e,r);return i.customData._tokenResponse=t,i}function Eh(n){return n!==void 0&&n.enterprise!==void 0}var Go=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return T_(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};async function v_(n,e){return it(n,"GET","/v2/recaptchaConfig",Pt(n,e))}async function A_(n,e){return it(n,"POST","/v1/accounts:delete",e)}async function Pi(n,e){return it(n,"POST","/v1/accounts:lookup",e)}function pr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Bh(n,e=!1){let t=ne(n),r=await t.getIdToken(e),i=da(r);M(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:pr(qo(i.auth_time)),issuedAtTime:pr(qo(i.iat)),expirationTime:pr(qo(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function qo(n){return Number(n)*1e3}function da(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ti("JWT malformed, contained fewer than 3 sections"),null;try{let i=hi(t);return i?JSON.parse(i):(Ti("Failed to decode base64 JWT payload"),null)}catch(i){return Ti("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Th(n){let e=da(n);return M(e,"internal-error"),M(typeof e.exp<"u","internal-error"),M(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function _n(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ge&&b_(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function b_({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Wo=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}};var gr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=pr(this.lastLoginAt),this.creationTime=pr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};async function Ci(n){let e=n.auth,t=await n.getIdToken(),r=await _n(n,Pi(e,{idToken:t}));M(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let o=i.providerUserInfo?.length?jh(i.providerUserInfo):[],a=S_(n.providerData,o),u=n.isAnonymous,h=!(n.email&&i.passwordHash)&&!a?.length,d=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new gr(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function zh(n){let e=ne(n);await Ci(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function S_(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function jh(n){return n.map(r=>{var i=r,{providerId:e}=i,t=go(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}async function R_(n,e){let t=await Uh(n,{},async()=>{let r=hr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=await qh(n,i,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:u,body:r};return n.emulatorConfig&&Tt(n.emulatorConfig.host)&&(h.credentials="include"),Ri.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function P_(n,e){return it(n,"POST","/v2/accounts:revokeToken",Pt(n,e))}var mr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){M(e.idToken,"internal-error"),M(typeof e.idToken<"u","internal-error"),M(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Th(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){M(e.length!==0,"internal-error");let t=Th(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(M(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:i,expiresIn:o}=await R_(e,t);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(M(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(M(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(M(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return tt("not implemented")}};function bt(n,e){M(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var St=class n{constructor(o){var a=o,{uid:e,auth:t,stsTokenManager:r}=a,i=go(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wo(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new gr(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await _n(this,this.stsTokenManager.getToken(this.auth,e));return M(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Bh(this,e)}reload(){return zh(this)}_assign(e){this!==e&&(M(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>B({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(le(B({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){M(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ci(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Pe(this.auth.app))return Promise.reject(rt(this.auth));let e=await this.getIdToken();return await _n(this,A_(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return le(B({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>B({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:y,emailVerified:T,isAnonymous:R,providerData:N,stsTokenManager:O}=t;M(y&&O,e,"internal-error");let D=mr.fromJSON(this.name,O);M(typeof y=="string",e,"internal-error"),bt(r,e.name),bt(i,e.name),M(typeof T=="boolean",e,"internal-error"),M(typeof R=="boolean",e,"internal-error"),bt(o,e.name),bt(a,e.name),bt(u,e.name),bt(h,e.name),bt(d,e.name),bt(p,e.name);let $=new n({uid:y,auth:e,email:i,emailVerified:T,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:D,createdAt:d,lastLoginAt:p});return N&&Array.isArray(N)&&($.providerData=N.map(K=>B({},K))),h&&($._redirectEventId=h),$}static async _fromIdTokenResponse(e,t,r=!1){let i=new mr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Ci(o),o}static async _fromGetAccountInfoResponse(e,t,r){let i=t.users[0];M(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?jh(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new mr;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new gr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h}};var vh=new Map;function nt(n){Rt(n instanceof Function,"Expected a class definition");let e=vh.get(n);return e?(Rt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,vh.set(n,e),e)}var C_=(()=>{class n{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){let r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Ko=C_;function vi(n,e,t){return`firebase:${n}:${e}:${t}`}var ki=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=vi(this.userKey,i.apiKey,o),this.fullPersistenceKey=vi("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=await Pi(this.auth,{idToken:e}).catch(()=>{});return t?St._fromGetAccountInfoResponse(this.auth,t,e):null}return St._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new n(nt(Ko),e,r);let i=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d),o=i[0]||nt(Ko),a=vi(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=await d._get(a);if(p){let y;if(typeof p=="string"){let T=await Pi(e,{idToken:p}).catch(()=>{});if(!T)break;y=await St._fromGetAccountInfoResponse(e,T,p)}else y=St._fromJSON(e,p);d!==o&&(u=y),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new n(o,e,r))}};function Ah(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Kh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($h(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Qh(e))return"Blackberry";if(Jh(e))return"Webos";if(Gh(e))return"Safari";if((e.includes("chrome/")||Wh(e))&&!e.includes("edge/"))return"Chrome";if(Hh(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function $h(n=he()){return/firefox\//i.test(n)}function Gh(n=he()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Wh(n=he()){return/crios\//i.test(n)}function Kh(n=he()){return/iemobile/i.test(n)}function Hh(n=he()){return/android/i.test(n)}function Qh(n=he()){return/blackberry/i.test(n)}function Jh(n=he()){return/webos/i.test(n)}function fa(n=he()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function k_(n=he()){return fa(n)&&!!window.navigator?.standalone}function D_(){return nh()&&document.documentMode===10}function Yh(n=he()){return fa(n)||Hh(n)||Jh(n)||Qh(n)||/windows phone/i.test(n)||Kh(n)}function Xh(n,e=[]){let t;switch(n){case"Browser":t=Ah(he());break;case"Worker":t=`${Ah(he())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${At}/${r}`}var Ho=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}};async function N_(n,e={}){return it(n,"GET","/v2/passwordPolicy",Pt(n,e))}var V_=6,Qo=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??V_,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var Jo=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Di(this),this.idTokenSubscription=new Di(this),this.beforeStateQueue=new Ho(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ki.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await Pi(this,{idToken:e}),r=await St._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Pe(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return M(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ci(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=y_()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Pe(this.app))return Promise.reject(rt(this));let t=e?ne(e):null;return t&&M(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&M(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Pe(this.app)?Promise.reject(rt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Pe(this.app)?Promise.reject(rt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=await N_(this),t=new Qo(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new De("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await P_(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&nt(e)||this._popupRedirectResolver;M(t,this,"argument-error"),this.redirectPersistenceManager=await ki.create(this,[nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(M(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return M(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Xh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Pe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&m_(`Error while retrieving App Check token: ${e.error}`),e?.token}};function jt(n){return ne(n)}var Di=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=oh(t=>this.observer=t)}get next(){return M(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Fi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function O_(n){Fi=n}function Zh(n){return Fi.loadJS(n)}function x_(){return Fi.recaptchaEnterpriseScript}function L_(){return Fi.gapiScript}function ed(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Yo=class{constructor(){this.enterprise=new Xo}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Xo=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var M_="recaptcha-enterprise",td="NO_RECAPTCHA",Zo=class{constructor(e){this.type=M_,this.auth=jt(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,u)=>{v_(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{let d=new Go(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{u(h)})})}function i(o,a,u){let h=window.grecaptcha;Eh(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(td)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Yo().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(u=>{if(!t&&Eh(window.grecaptcha))i(u,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=x_();h.length!==0&&(h+=u),Zh(h).then(()=>{i(u,o,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})}};async function fr(n,e,t,r=!1,i=!1){let o=new Zo(n),a;if(i)a=td;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}let u=B({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){let h=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){let h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function ea(n,e,t,r,i){if(i==="EMAIL_PASSWORD_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let o=await fr(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let a=await fr(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)});else if(i==="PHONE_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let o=await fr(n,e,t);return r(n,o).catch(async a=>{if(n._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(a.code==="auth/missing-recaptcha-token"||a.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let u=await fr(n,e,t,!1,!0);return r(n,u)}return Promise.reject(a)})}else{let o=await fr(n,e,t,!1,!0);return r(n,o)}else return Promise.reject(i+" provider is not supported.")}function nd(n,e){let t=Me(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(Ne(o,e??{}))return i;Ge(i,"already-initialized")}return t.initialize({options:e})}function F_(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(nt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function rd(n,e,t){let r=jt(n);M(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=id(e),{host:a,port:u}=U_(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){M(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),M(Ne(d,r.config.emulator)&&Ne(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Tt(a)?(fi(`${o}//${a}${h}`),pi("Auth",!0)):i||q_()}function id(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function U_(n){let e=id(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:bh(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:bh(a)}}}function bh(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function q_(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var _r=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tt("not implemented")}_getIdTokenResponse(e){return tt("not implemented")}_linkToIdToken(e,t){return tt("not implemented")}_getReauthenticationResolver(e){return tt("not implemented")}};async function B_(n,e){return it(n,"POST","/v1/accounts:signUp",e)}async function z_(n,e){return wr(n,"POST","/v1/accounts:signInWithPassword",Pt(n,e))}async function j_(n,e){return wr(n,"POST","/v1/accounts:signInWithEmailLink",Pt(n,e))}async function $_(n,e){return wr(n,"POST","/v1/accounts:signInWithEmailLink",Pt(n,e))}var yr=class n extends _r{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ea(e,t,"signInWithPassword",z_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return j_(e,{email:this._email,oobCode:this._password});default:Ge(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ea(e,r,"signUpPassword",B_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return $_(e,{idToken:t,email:this._email,oobCode:this._password});default:Ge(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};async function Bo(n,e){return wr(n,"POST","/v1/accounts:signInWithIdp",Pt(n,e))}function G_(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function W_(n){let e=mn(gn(n)).link,t=e?mn(gn(e)).deep_link_id:null,r=mn(gn(n)).deep_link_id;return(r?mn(gn(r)).link:null)||r||t||e||n}var Ni=class n{constructor(e){let t=mn(gn(e)),r=t.apiKey??null,i=t.oobCode??null,o=G_(t.mode??null);M(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=W_(e);try{return new n(t)}catch{return null}}};var sd=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return yr._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=Ni.parseLink(r);return M(i,"argument-error"),yr._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),Vi=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var ta=class extends Vi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};async function K_(n,e){return wr(n,"POST","/v1/accounts:signUp",Pt(n,e))}var yn=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){let o=await St._fromIdTokenResponse(e,r,i),a=Sh(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);let i=Sh(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})}};function Sh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var na=class n extends ge{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function od(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?na._fromErrorAndOperation(n,o,e,r):o})}async function H_(n,e,t=!1){let r=await _n(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return yn._forOperation(n,"link",r)}async function Q_(n,e,t=!1){let{auth:r}=n;if(Pe(r.app))return Promise.reject(rt(r));let i="reauthenticate";try{let o=await _n(n,od(r,i,e,n),t);M(o.idToken,r,"internal-error");let a=da(o.idToken);M(a,r,"internal-error");let{sub:u}=a;return M(n.uid===u,r,"user-mismatch"),yn._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&Ge(r,"user-mismatch"),o}}async function ad(n,e,t=!1){if(Pe(n.app))return Promise.reject(rt(n));let r="signIn",i=await od(n,r,e),o=await yn._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(o.user),o}async function cd(n,e){return ad(jt(n),e)}async function ud(n){let e=jt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function pa(n,e,t){if(Pe(n.app))return Promise.reject(rt(n));let r=jt(n),a=await ea(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",K_,"EMAIL_PASSWORD_PROVIDER").catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&ud(n),h}),u=await yn._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function ma(n,e,t){return Pe(n.app)?Promise.reject(rt(n)):cd(ne(n),sd.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&ud(n),r})}async function J_(n,e){return it(n,"POST","/v1/accounts:update",e)}async function ga(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let r=ne(n),o={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await _n(r,J_(r.auth,o));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;let u=r.providerData.find(({providerId:h})=>h==="password");u&&(u.displayName=r.displayName,u.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function ld(n,e,t,r){return ne(n).onIdTokenChanged(e,t,r)}function hd(n,e,t){return ne(n).beforeAuthStateChanged(e,t)}function Ui(n,e,t,r){return ne(n).onAuthStateChanged(e,t,r)}function _a(n){return ne(n).signOut()}var Oi="__sak";var xi=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Oi,"1"),this.storage.removeItem(Oi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Y_=1e3,X_=10,Z_=(()=>{class n extends xi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Yh(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,h,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);D_()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,X_):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Y_)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){let r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}return n.type="LOCAL",n})(),dd=Z_;var ey=(()=>{class n extends xi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),ya=ey;function ty(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}var ny=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let h=Array.from(u).map(async p=>p(r.origin,a)),d=await ty(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function fd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var ra=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{let d=fd("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(y){let T=y;if(T.data.eventId===d)switch(T.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(T.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}};function $e(){return window}function ry(n){$e().location.href=n}function pd(){return typeof $e().WorkerGlobalScope<"u"&&typeof $e().importScripts=="function"}async function iy(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function sy(){return navigator?.serviceWorker?.controller||null}function oy(){return pd()?self:null}var md="firebaseLocalStorageDb",ay=1,Li="firebaseLocalStorage",gd="fbase_key",zt=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function qi(n,e){return n.transaction([Li],e?"readwrite":"readonly").objectStore(Li)}function cy(){let n=indexedDB.deleteDatabase(md);return new zt(n).toPromise()}function ia(){let n=indexedDB.open(md,ay);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Li,{keyPath:gd})}catch(i){t(i)}}),n.addEventListener("success",async()=>{let r=n.result;r.objectStoreNames.contains(Li)?e(r):(r.close(),await cy(),e(await ia()))})})}async function Rh(n,e,t){let r=qi(n,!0).put({[gd]:e,value:t});return new zt(r).toPromise()}async function uy(n,e){let t=qi(n,!1).get(e),r=await new zt(t).toPromise();return r===void 0?null:r.value}function Ph(n,e){let t=qi(n,!0).delete(e);return new zt(t).toPromise()}var ly=800,hy=3,dy=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ia(),this.db)}async _withRetries(t){let r=0;for(;;)try{let i=await this._openDb();return await t(i)}catch(i){if(r++>hy)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return pd()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ny._getInstance(oy()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await iy(),!this.activeServiceWorker)return;this.sender=new ra(this.activeServiceWorker);let t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||sy()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let t=await ia();return await Rh(t,Oi,"1"),await Ph(t,Oi),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(i=>Rh(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){let r=await this._withRetries(i=>uy(i,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Ph(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){let t=await this._withRetries(o=>{let a=qi(o,!1).getAll();return new zt(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ly)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),_d=dy;var lv=ed("rcb"),hv=new Bt(3e4,6e4);function fy(n,e){return e?nt(e):(M(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Ir=class extends _r{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bo(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Bo(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Bo(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function py(n){return ad(n.auth,new Ir(n),n.bypassAuthState)}function my(n){let{auth:e,user:t}=n;return M(t,e,"internal-error"),Q_(t,new Ir(n),n.bypassAuthState)}async function gy(n){let{auth:e,user:t}=n;return M(t,e,"internal-error"),H_(t,new Ir(n),n.bypassAuthState)}var sa=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return py;case"linkViaPopup":case"linkViaRedirect":return gy;case"reauthViaPopup":case"reauthViaRedirect":return my;default:Ge(this.auth,"internal-error")}}resolve(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var dv=new Bt(2e3,1e4);var _y="pendingRedirect",Ai=new Map,oa=class extends sa{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ai.get(this.auth._key());if(!e){try{let r=await yy(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ai.set(this.auth._key(),e)}return this.bypassAuthState||Ai.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}};async function yy(n,e){let t=Ey(e),r=wy(n);if(!await r._isAvailable())return!1;let i=await r._get(t)==="true";return await r._remove(t),i}function Iy(n,e){Ai.set(n._key(),e)}function wy(n){return nt(n._redirectPersistence)}function Ey(n){return vi(_y,n.config.apiKey,n.name)}async function Ty(n,e,t=!1){if(Pe(n.app))return Promise.reject(rt(n));let r=jt(n),i=fy(r,e),a=await new oa(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}var vy=600*1e3,aa=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Ay(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!yd(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(qt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=vy&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ch(e))}saveEventToCache(e){this.cachedEventUids.add(Ch(e)),this.lastProcessedEventTime=Date.now()}};function Ch(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function yd({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Ay(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yd(n);default:return!1}}async function by(n,e={}){return it(n,"GET","/v1/projects",e)}var Sy=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ry=/^https?/;async function Py(n){if(n.config.emulator)return;let{authorizedDomains:e}=await by(n);for(let t of e)try{if(Cy(t))return}catch{}Ge(n,"unauthorized-domain")}function Cy(n){let e=jo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Ry.test(t))return!1;if(Sy.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var ky=new Bt(3e4,6e4);function kh(){let n=$e().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Dy(n){return new Promise((e,t)=>{function r(){kh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{kh(),t(qt(n,"network-request-failed"))},timeout:ky.get()})}if($e().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if($e().gapi?.load)r();else{let i=ed("iframefcb");return $e()[i]=()=>{gapi.load?r():t(qt(n,"network-request-failed"))},Zh(`${L_()}?onload=${i}`).catch(o=>t(o))}}).catch(e=>{throw bi=null,e})}var bi=null;function Ny(n){return bi=bi||Dy(n),bi}var Vy=new Bt(5e3,15e3),Oy="__/auth/iframe",xy="emulator/auth/iframe",Ly={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},My=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fy(n){let e=n.config;M(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?ha(e,xy):`https://${n.config.authDomain}/${Oy}`,r={apiKey:e.apiKey,appName:n.name,v:At},i=My.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${hr(r).slice(1)}`}async function Uy(n){let e=await Ny(n),t=$e().gapi;return M(t,n,"internal-error"),e.open({where:document.body,url:Fy(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ly,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});let a=qt(n,"network-request-failed"),u=$e().setTimeout(()=>{o(a)},Vy.get());function h(){$e().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(a)})}))}var qy={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},By=500,zy=600,jy="_blank",$y="http://localhost",Mi=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function Gy(n,e,t,r=By,i=zy){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",h=le(B({},qy),{width:r.toString(),height:i.toString(),top:o,left:a}),d=he().toLowerCase();t&&(u=Wh(d)?jy:t),$h(d)&&(e=e||$y,h.scrollbars="yes");let p=Object.entries(h).reduce((T,[R,N])=>`${T}${R}=${N},`,"");if(k_(d)&&u!=="_self")return Wy(e||"",u),new Mi(null);let y=window.open(e||"",u,p);M(y,n,"popup-blocked");try{y.focus()}catch{}return new Mi(y)}function Wy(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var Ky="__/auth/handler",Hy="emulator/auth/handler",Qy=encodeURIComponent("fac");async function Dh(n,e,t,r,i,o){M(n.config.authDomain,n,"auth-domain-config-required"),M(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:At,eventId:i};if(e instanceof Vi){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",sh(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,y]of Object.entries(o||{}))a[p]=y}if(e instanceof ta){let p=e.getScopes().filter(y=>y!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let h=await n._getAppCheckToken(),d=h?`#${Qy}=${encodeURIComponent(h)}`:"";return`${Jy(n)}?${hr(u).slice(1)}${d}`}function Jy({config:n}){return n.emulator?ha(n,Hy):`https://${n.authDomain}/${Ky}`}var zo="webStorageSupport",ca=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ya,this._completeRedirectFn=Ty,this._overrideRedirectResult=Iy}async _openPopup(e,t,r,i){Rt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");let o=await Dh(e,t,r,jo(),i);return Gy(e,o,fd())}async _openRedirect(e,t,r,i){await this._originValidation(e);let o=await Dh(e,t,r,jo(),i);return ry(o),new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(Rt(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await Uy(e),r=new aa(e);return t.register("authEvent",i=>(M(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(zo,{type:zo},i=>{let o=i?.[0]?.[zo];o!==void 0&&t(!!o),Ge(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Py(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Yh()||Gh()||fa()}},Id=ca;var Nh="@firebase/auth",Vh="1.12.0";var ua=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){M(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Yy(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Xy(n){Re(new de("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;M(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xh(n)},d=new Jo(r,i,o,h);return F_(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Re(new de("auth-internal",e=>{let t=jt(e.getProvider("auth").getImmediate());return(r=>new ua(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),_e(Nh,Vh,Yy(n)),_e(Nh,Vh,"esm2020")}var Zy=300,eI=vo("authIdTokenMaxAge")||Zy,Oh=null,tI=n=>async e=>{let t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>eI)return;let i=t?.token;Oh!==i&&(Oh=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Ia(n=Ut()){let e=Me(n,"auth");if(e.isInitialized())return e.getImmediate();let t=nd(n,{popupRedirectResolver:Id,persistence:[_d,dd,ya]}),r=vo("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=tI(o.toString());hd(t,a,()=>a(t.currentUser)),ld(t,u=>a(u))}}let i=Eo("auth");return i&&rd(t,`http://${i}`),t}function nI(){return document.getElementsByTagName("head")?.[0]??document}O_({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=qt("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",nI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Xy("Browser");var wd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ed={};var st,wa;(function(){var n;function e(w,m){function _(){}_.prototype=m.prototype,w.F=m.prototype,w.prototype=new _,w.prototype.constructor=w,w.D=function(E,I,A){for(var g=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)g[Se-2]=arguments[Se];return m.prototype[I].apply(E,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,m,_){_||(_=0);let E=Array(16);if(typeof m=="string")for(var I=0;I<16;++I)E[I]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(I=0;I<16;++I)E[I]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=w.g[0],_=w.g[1],I=w.g[2];let A=w.g[3],g;g=m+(A^_&(I^A))+E[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+E[1]+3905402710&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+E[2]+606105819&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+E[3]+3250441966&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(A^_&(I^A))+E[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+E[5]+1200080426&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+E[6]+2821735955&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+E[7]+4249261313&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(A^_&(I^A))+E[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+E[9]+2336552879&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+E[10]+4294925233&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+E[11]+2304563134&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(A^_&(I^A))+E[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+E[13]+4254626195&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+E[14]+2792965006&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+E[15]+1236535329&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(I^A&(_^I))+E[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+E[6]+3225465664&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+E[11]+643717713&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+E[0]+3921069994&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(I^A&(_^I))+E[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+E[10]+38016083&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+E[15]+3634488961&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+E[4]+3889429448&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(I^A&(_^I))+E[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+E[14]+3275163606&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+E[3]+4107603335&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+E[8]+1163531501&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(I^A&(_^I))+E[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+E[2]+4243563512&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+E[7]+1735328473&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+E[12]+2368359562&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(_^I^A)+E[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+E[8]+2272392833&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+E[11]+1839030562&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+E[14]+4259657740&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(_^I^A)+E[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+E[4]+1272893353&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+E[7]+4139469664&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+E[10]+3200236656&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(_^I^A)+E[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+E[0]+3936430074&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+E[3]+3572445317&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+E[6]+76029189&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(_^I^A)+E[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+E[12]+3873151461&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+E[15]+530742520&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+E[2]+3299628645&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(I^(_|~A))+E[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+E[7]+1126891415&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+E[14]+2878612391&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+E[5]+4237533241&4294967295,_=I+(g<<21&4294967295|g>>>11),g=m+(I^(_|~A))+E[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+E[3]+2399980690&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+E[10]+4293915773&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+E[1]+2240044497&4294967295,_=I+(g<<21&4294967295|g>>>11),g=m+(I^(_|~A))+E[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+E[15]+4264355552&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+E[6]+2734768916&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+E[13]+1309151649&4294967295,_=I+(g<<21&4294967295|g>>>11),g=m+(I^(_|~A))+E[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+E[11]+3174756917&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+E[2]+718787259&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(I+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+A&4294967295}r.prototype.v=function(w,m){m===void 0&&(m=w.length);let _=m-this.blockSize,E=this.C,I=this.h,A=0;for(;A<m;){if(I==0)for(;A<=_;)i(this,w,A),A+=this.blockSize;if(typeof w=="string"){for(;A<m;)if(E[I++]=w.charCodeAt(A++),I==this.blockSize){i(this,E),I=0;break}}else for(;A<m;)if(E[I++]=w[A++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=m},r.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;m=this.o*8;for(var _=w.length-8;_<w.length;++_)w[_]=m&255,m/=256;for(this.v(w),w=Array(16),m=0,_=0;_<4;++_)for(let E=0;E<32;E+=8)w[m++]=this.g[_]>>>E&255;return w};function o(w,m){var _=u;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=m(w)}function a(w,m){this.h=m;let _=[],E=!0;for(let I=w.length-1;I>=0;I--){let A=w[I]|0;E&&A==m||(_[I]=A,E=!1)}this.g=_}var u={};function h(w){return-128<=w&&w<128?o(w,function(m){return new a([m|0],m<0?-1:0)}):new a([w|0],w<0?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return y;if(w<0)return D(d(-w));let m=[],_=1;for(let E=0;w>=_;E++)m[E]=w/_|0,_*=4294967296;return new a(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return D(p(w.substring(1),m));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');let _=d(Math.pow(m,8)),E=y;for(let A=0;A<w.length;A+=8){var I=Math.min(8,w.length-A);let g=parseInt(w.substring(A,A+I),m);I<8?(I=d(Math.pow(m,I)),E=E.j(I).add(d(g))):(E=E.j(_),E=E.add(d(g)))}return E}var y=h(0),T=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-D(this).m();let w=0,m=1;for(let _=0;_<this.g.length;_++){let E=this.i(_);w+=(E>=0?E:4294967296+E)*m,m*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(N(this))return"0";if(O(this))return"-"+D(this).toString(w);let m=d(Math.pow(w,6));var _=this;let E="";for(;;){let I=we(_,m).g;_=$(_,I.j(m));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(w);if(_=I,N(_))return A+E;for(;A.length<6;)A="0"+A;E=A+E}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function N(w){if(w.h!=0)return!1;for(let m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function O(w){return w.h==-1}n.l=function(w){return w=$(this,w),O(w)?-1:N(w)?0:1};function D(w){let m=w.g.length,_=[];for(let E=0;E<m;E++)_[E]=~w.g[E];return new a(_,~w.h).add(T)}n.abs=function(){return O(this)?D(this):this},n.add=function(w){let m=Math.max(this.g.length,w.g.length),_=[],E=0;for(let I=0;I<=m;I++){let A=E+(this.i(I)&65535)+(w.i(I)&65535),g=(A>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);E=g>>>16,A&=65535,g&=65535,_[I]=g<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function $(w,m){return w.add(D(m))}n.j=function(w){if(N(this)||N(w))return y;if(O(this))return O(w)?D(this).j(D(w)):D(D(this).j(w));if(O(w))return D(this.j(D(w)));if(this.l(R)<0&&w.l(R)<0)return d(this.m()*w.m());let m=this.g.length+w.g.length,_=[];for(var E=0;E<2*m;E++)_[E]=0;for(E=0;E<this.g.length;E++)for(let I=0;I<w.g.length;I++){let A=this.i(E)>>>16,g=this.i(E)&65535,Se=w.i(I)>>>16,mt=w.i(I)&65535;_[2*E+2*I]+=g*mt,K(_,2*E+2*I),_[2*E+2*I+1]+=A*mt,K(_,2*E+2*I+1),_[2*E+2*I+1]+=g*Se,K(_,2*E+2*I+1),_[2*E+2*I+2]+=A*Se,K(_,2*E+2*I+2)}for(w=0;w<m;w++)_[w]=_[2*w+1]<<16|_[2*w];for(w=m;w<2*m;w++)_[w]=0;return new a(_,0)};function K(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function J(w,m){this.g=w,this.h=m}function we(w,m){if(N(m))throw Error("division by zero");if(N(w))return new J(y,y);if(O(w))return m=we(D(w),m),new J(D(m.g),D(m.h));if(O(m))return m=we(w,D(m)),new J(D(m.g),m.h);if(w.g.length>30){if(O(w)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var _=T,E=m;E.l(w)<=0;)_=Le(_),E=Le(E);var I=me(_,1),A=me(E,1);for(E=me(E,2),_=me(_,2);!N(E);){var g=A.add(E);g.l(w)<=0&&(I=I.add(_),A=g),E=me(E,1),_=me(_,1)}return m=$(w,I.j(m)),new J(I,m)}for(I=y;w.l(m)>=0;){for(_=Math.max(1,Math.floor(w.m()/m.m())),E=Math.ceil(Math.log(_)/Math.LN2),E=E<=48?1:Math.pow(2,E-48),A=d(_),g=A.j(m);O(g)||g.l(w)>0;)_-=E,A=d(_),g=A.j(m);N(A)&&(A=T),I=I.add(A),w=$(w,g)}return new J(I,w)}n.B=function(w){return we(this,w).h},n.and=function(w){let m=Math.max(this.g.length,w.g.length),_=[];for(let E=0;E<m;E++)_[E]=this.i(E)&w.i(E);return new a(_,this.h&w.h)},n.or=function(w){let m=Math.max(this.g.length,w.g.length),_=[];for(let E=0;E<m;E++)_[E]=this.i(E)|w.i(E);return new a(_,this.h|w.h)},n.xor=function(w){let m=Math.max(this.g.length,w.g.length),_=[];for(let E=0;E<m;E++)_[E]=this.i(E)^w.i(E);return new a(_,this.h^w.h)};function Le(w){let m=w.g.length+1,_=[];for(let E=0;E<m;E++)_[E]=w.i(E)<<1|w.i(E-1)>>>31;return new a(_,w.h)}function me(w,m){let _=m>>5;m%=32;let E=w.g.length-_,I=[];for(let A=0;A<E;A++)I[A]=m>0?w.i(A+_)>>>m|w.i(A+_+1)<<32-m:w.i(A+_);return new a(I,w.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,wa=Ed.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,st=Ed.Integer=a}).apply(typeof wd<"u"?wd:typeof self<"u"?self:typeof window<"u"?window:{});var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ot={};var Ea,rI,In,Ta,Er,zi,va,Aa,ba;(function(){var n,e=Object.defineProperty;function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bi=="object"&&Bi];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var v=s[f];if(!(v in l))break e;l=l[v]}s=s[s.length-1],f=l[s],c=c(f),c!=f&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}i("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(s){return s||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function h(s,c,l){return s.call.apply(s.bind,arguments)}function d(s,c,l){return d=h,d.apply(null,arguments)}function p(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function y(s,c){function l(){}l.prototype=c.prototype,s.Z=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Ob=function(f,v,b){for(var C=Array(arguments.length-2),q=2;q<arguments.length;q++)C[q-2]=arguments[q];return c.prototype[v].apply(f,C)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function R(s){let c=s.length;if(c>0){let l=Array(c);for(let f=0;f<c;f++)l[f]=s[f];return l}return[]}function N(s,c){for(let f=1;f<arguments.length;f++){let v=arguments[f];var l=typeof v;if(l=l!="object"?l:v?Array.isArray(v)?"array":l:"null",l=="array"||l=="object"&&typeof v.length=="number"){l=s.length||0;let b=v.length||0;s.length=l+b;for(let C=0;C<b;C++)s[l+C]=v[C]}else s.push(v)}}class O{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function D(s){a.setTimeout(()=>{throw s},0)}function $(){var s=w;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class K{constructor(){this.h=this.g=null}add(c,l){let f=J.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var J=new O(()=>new we,s=>s.reset());class we{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Le,me=!1,w=new K,m=()=>{let s=Promise.resolve(void 0);Le=()=>{s.then(_)}};function _(){for(var s;s=$();){try{s.h.call(s.g)}catch(l){D(l)}var c=J;c.j(s),c.h<100&&(c.h++,s.next=c.g,c.g=s)}me=!1}function E(){this.u=this.u,this.C=this.C}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return s})();function g(s){return/^[\s\xa0]*$/.test(s)}function Se(s,c){I.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,c)}y(Se,I),Se.prototype.init=function(s,c){let l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget,c||(l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&Se.Z.h.call(this)},Se.prototype.h=function(){Se.Z.h.call(this);let s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var mt="closure_listenable_"+(Math.random()*1e6|0),Em=0;function Tm(s,c,l,f,v){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=v,this.key=++Em,this.da=this.fa=!1}function Kr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Hr(s,c,l){for(let f in s)c.call(l,s[f],f,s)}function vm(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function qu(s){let c={};for(let l in s)c[l]=s[l];return c}let Bu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zu(s,c){let l,f;for(let v=1;v<arguments.length;v++){f=arguments[v];for(l in f)s[l]=f[l];for(let b=0;b<Bu.length;b++)l=Bu[b],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function Qr(s){this.src=s,this.g={},this.h=0}Qr.prototype.add=function(s,c,l,f,v){let b=s.toString();s=this.g[b],s||(s=this.g[b]=[],this.h++);let C=Ws(s,c,f,v);return C>-1?(c=s[C],l||(c.fa=!1)):(c=new Tm(c,this.src,b,!!f,v),c.fa=l,s.push(c)),c};function Gs(s,c){let l=c.type;if(l in s.g){var f=s.g[l],v=Array.prototype.indexOf.call(f,c,void 0),b;(b=v>=0)&&Array.prototype.splice.call(f,v,1),b&&(Kr(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function Ws(s,c,l,f){for(let v=0;v<s.length;++v){let b=s[v];if(!b.da&&b.listener==c&&b.capture==!!l&&b.ha==f)return v}return-1}var Ks="closure_lm_"+(Math.random()*1e6|0),Hs={};function ju(s,c,l,f,v){if(f&&f.once)return Gu(s,c,l,f,v);if(Array.isArray(c)){for(let b=0;b<c.length;b++)ju(s,c[b],l,f,v);return null}return l=Xs(l),s&&s[mt]?s.J(c,l,u(f)?!!f.capture:!!f,v):$u(s,c,l,!1,f,v)}function $u(s,c,l,f,v,b){if(!c)throw Error("Invalid event type");let C=u(v)?!!v.capture:!!v,q=Js(s);if(q||(s[Ks]=q=new Qr(s)),l=q.add(c,l,f,C,b),l.proxy)return l;if(f=Am(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)A||(v=C),v===void 0&&(v=!1),s.addEventListener(c.toString(),f,v);else if(s.attachEvent)s.attachEvent(Ku(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Am(){function s(l){return c.call(s.src,s.listener,l)}let c=bm;return s}function Gu(s,c,l,f,v){if(Array.isArray(c)){for(let b=0;b<c.length;b++)Gu(s,c[b],l,f,v);return null}return l=Xs(l),s&&s[mt]?s.K(c,l,u(f)?!!f.capture:!!f,v):$u(s,c,l,!0,f,v)}function Wu(s,c,l,f,v){if(Array.isArray(c))for(var b=0;b<c.length;b++)Wu(s,c[b],l,f,v);else f=u(f)?!!f.capture:!!f,l=Xs(l),s&&s[mt]?(s=s.i,b=String(c).toString(),b in s.g&&(c=s.g[b],l=Ws(c,l,f,v),l>-1&&(Kr(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete s.g[b],s.h--)))):s&&(s=Js(s))&&(c=s.g[c.toString()],s=-1,c&&(s=Ws(c,l,f,v)),(l=s>-1?c[s]:null)&&Qs(l))}function Qs(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[mt])Gs(c.i,s);else{var l=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(l,f,s.capture):c.detachEvent?c.detachEvent(Ku(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=Js(c))?(Gs(l,s),l.h==0&&(l.src=null,c[Ks]=null)):Kr(s)}}}function Ku(s){return s in Hs?Hs[s]:Hs[s]="on"+s}function bm(s,c){if(s.da)s=!0;else{c=new Se(c,this);let l=s.listener,f=s.ha||s.src;s.fa&&Qs(s),s=l.call(f,c)}return s}function Js(s){return s=s[Ks],s instanceof Qr?s:null}var Ys="__closure_events_fn_"+(Math.random()*1e9>>>0);function Xs(s){return typeof s=="function"?s:(s[Ys]||(s[Ys]=function(c){return s.handleEvent(c)}),s[Ys])}function Ee(){E.call(this),this.i=new Qr(this),this.M=this,this.G=null}y(Ee,E),Ee.prototype[mt]=!0,Ee.prototype.removeEventListener=function(s,c,l,f){Wu(this,s,c,l,f)};function ve(s,c){var l,f=s.G;if(f)for(l=[];f;f=f.G)l.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new I(c,s);else if(c instanceof I)c.target=c.target||s;else{var v=c;c=new I(f,s),zu(c,v)}v=!0;let b,C;if(l)for(C=l.length-1;C>=0;C--)b=c.g=l[C],v=Jr(b,f,!0,c)&&v;if(b=c.g=s,v=Jr(b,f,!0,c)&&v,v=Jr(b,f,!1,c)&&v,l)for(C=0;C<l.length;C++)b=c.g=l[C],v=Jr(b,f,!1,c)&&v}Ee.prototype.N=function(){if(Ee.Z.N.call(this),this.i){var s=this.i;for(let c in s.g){let l=s.g[c];for(let f=0;f<l.length;f++)Kr(l[f]);delete s.g[c],s.h--}}this.G=null},Ee.prototype.J=function(s,c,l,f){return this.i.add(String(s),c,!1,l,f)},Ee.prototype.K=function(s,c,l,f){return this.i.add(String(s),c,!0,l,f)};function Jr(s,c,l,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();let v=!0;for(let b=0;b<c.length;++b){let C=c[b];if(C&&!C.da&&C.capture==l){let q=C.listener,ce=C.ha||C.src;C.fa&&Gs(s.i,C),v=q.call(ce,f)!==!1&&v}}return v&&!f.defaultPrevented}function Sm(s,c){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=d(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(s,c||0)}function Hu(s){s.g=Sm(()=>{s.g=null,s.i&&(s.i=!1,Hu(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class Rm extends E{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Hu(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wn(s){E.call(this),this.h=s,this.g={}}y(Wn,E);var Qu=[];function Ju(s){Hr(s.g,function(c,l){this.g.hasOwnProperty(l)&&Qs(c)},s),s.g={}}Wn.prototype.N=function(){Wn.Z.N.call(this),Ju(this)},Wn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zs=a.JSON.stringify,Pm=a.JSON.parse,Cm=class{stringify(s){return a.JSON.stringify(s,void 0)}parse(s){return a.JSON.parse(s,void 0)}};function Yu(){}function Xu(){}var Kn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function eo(){I.call(this,"d")}y(eo,I);function to(){I.call(this,"c")}y(to,I);var Vt={},Zu=null;function Yr(){return Zu=Zu||new Ee}Vt.Ia="serverreachability";function el(s){I.call(this,Vt.Ia,s)}y(el,I);function Hn(s){let c=Yr();ve(c,new el(c))}Vt.STAT_EVENT="statevent";function tl(s,c){I.call(this,Vt.STAT_EVENT,s),this.stat=c}y(tl,I);function Ae(s){let c=Yr();ve(c,new tl(c,s))}Vt.Ja="timingevent";function nl(s,c){I.call(this,Vt.Ja,s),this.size=c}y(nl,I);function Qn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){s()},c)}function Jn(){this.g=!0}Jn.prototype.ua=function(){this.g=!1};function km(s,c,l,f,v,b){s.info(function(){if(s.g)if(b){var C="",q=b.split("&");for(let Q=0;Q<q.length;Q++){var ce=q[Q].split("=");if(ce.length>1){let ue=ce[0];ce=ce[1];let Be=ue.split("_");C=Be.length>=2&&Be[1]=="type"?C+(ue+"="+ce+"&"):C+(ue+"=redacted&")}}}else C=null;else C=b;return"XMLHTTP REQ ("+f+") [attempt "+v+"]: "+c+`
`+l+`
`+C})}function Dm(s,c,l,f,v,b,C){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+v+"]: "+c+`
`+l+`
`+b+" "+C})}function dn(s,c,l,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Vm(s,l)+(f?" "+f:"")})}function Nm(s,c){s.info(function(){return"TIMEOUT: "+c})}Jn.prototype.info=function(){};function Vm(s,c){if(!s.g)return c;if(!c)return null;try{let b=JSON.parse(c);if(b){for(s=0;s<b.length;s++)if(Array.isArray(b[s])){var l=b[s];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var v=f[0];if(v!="noop"&&v!="stop"&&v!="close")for(let C=1;C<f.length;C++)f[C]=""}}}}return Zs(b)}catch{return c}}var Xr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},rl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},il;function no(){}y(no,Yu),no.prototype.g=function(){return new XMLHttpRequest},il=new no;function Yn(s){return encodeURIComponent(String(s))}function Om(s){var c=1;s=s.split(":");let l=[];for(;c>0&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function gt(s,c,l,f){this.j=s,this.i=c,this.l=l,this.S=f||1,this.V=new Wn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new sl}function sl(){this.i=null,this.g="",this.h=!1}var ol={},ro={};function io(s,c,l){s.M=1,s.A=ei(qe(c)),s.u=l,s.R=!0,al(s,null)}function al(s,c){s.F=Date.now(),Zr(s),s.B=qe(s.A);var l=s.B,f=s.S;Array.isArray(f)||(f=[String(f)]),wl(l.i,"t",f),s.C=0,l=s.j.L,s.h=new sl,s.g=Fl(s.j,l?c:null,!s.u),s.P>0&&(s.O=new Rm(d(s.Y,s,s.g),s.P)),c=s.V,l=s.g,f=s.ba;var v="readystatechange";Array.isArray(v)||(v&&(Qu[0]=v.toString()),v=Qu);for(let b=0;b<v.length;b++){let C=ju(l,v[b],f||c.handleEvent,!1,c.h||c);if(!C)break;c.g[C.key]=C}c=s.J?qu(s.J):{},s.u?(s.v||(s.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,c)):(s.v="GET",s.g.ea(s.B,s.v,null,c)),Hn(),km(s.i,s.v,s.B,s.l,s.S,s.u)}gt.prototype.ba=function(s){s=s.target;let c=this.O;c&&It(s)==3?c.j():this.Y(s)},gt.prototype.Y=function(s){try{if(s==this.g)e:{let q=It(this.g),ce=this.g.ya(),Q=this.g.ca();if(!(q<3)&&(q!=3||this.g&&(this.h.h||this.g.la()||Rl(this.g)))){this.K||q!=4||ce==7||(ce==8||Q<=0?Hn(3):Hn(2)),so(this);var c=this.g.ca();this.X=c;var l=xm(this);if(this.o=c==200,Dm(this.i,this.v,this.B,this.l,this.S,q,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,v=this.g;if((f=v.g?v.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var b=f;break t}}b=null}if(s=b)dn(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,oo(this,s);else{this.o=!1,this.m=3,Ae(12),Ot(this),Xn(this);break e}}if(this.R){s=!0;let ue;for(;!this.K&&this.C<l.length;)if(ue=Lm(this,l),ue==ro){q==4&&(this.m=4,Ae(14),s=!1),dn(this.i,this.l,null,"[Incomplete Response]");break}else if(ue==ol){this.m=4,Ae(15),dn(this.i,this.l,l,"[Invalid Chunk]"),s=!1;break}else dn(this.i,this.l,ue,null),oo(this,ue);if(cl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),q!=4||l.length!=0||this.h.h||(this.m=1,Ae(16),s=!1),this.o=this.o&&s,!s)dn(this.i,this.l,l,"[Invalid Chunked Response]"),Ot(this),Xn(this);else if(l.length>0&&!this.W){this.W=!0;var C=this.j;C.g==this&&C.aa&&!C.P&&(C.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),po(C),C.P=!0,Ae(11))}}else dn(this.i,this.l,l,null),oo(this,l);q==4&&Ot(this),this.o&&!this.K&&(q==4?Ol(this.j,this):(this.o=!1,Zr(this)))}else Jm(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,Ae(12)):(this.m=0,Ae(13)),Ot(this),Xn(this)}}}catch{}};function xm(s){if(!cl(s))return s.g.la();let c=Rl(s.g);if(c==="")return"";let l="",f=c.length,v=It(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return Ot(s),Xn(s),"";s.h.i=new a.TextDecoder}for(let b=0;b<f;b++)s.h.h=!0,l+=s.h.i.decode(c[b],{stream:!(v&&b==f-1)});return c.length=0,s.h.g+=l,s.C=0,s.h.g}function cl(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function Lm(s,c){var l=s.C,f=c.indexOf(`
`,l);return f==-1?ro:(l=Number(c.substring(l,f)),isNaN(l)?ol:(f+=1,f+l>c.length?ro:(c=c.slice(f,f+l),s.C=f+l,c)))}gt.prototype.cancel=function(){this.K=!0,Ot(this)};function Zr(s){s.T=Date.now()+s.H,ul(s,s.H)}function ul(s,c){if(s.D!=null)throw Error("WatchDog timer not null");s.D=Qn(d(s.aa,s),c)}function so(s){s.D&&(a.clearTimeout(s.D),s.D=null)}gt.prototype.aa=function(){this.D=null;let s=Date.now();s-this.T>=0?(Nm(this.i,this.B),this.M!=2&&(Hn(),Ae(17)),Ot(this),this.m=2,Xn(this)):ul(this,this.T-s)};function Xn(s){s.j.I==0||s.K||Ol(s.j,s)}function Ot(s){so(s);var c=s.O;c&&typeof c.dispose=="function"&&c.dispose(),s.O=null,Ju(s.V),s.g&&(c=s.g,s.g=null,c.abort(),c.dispose())}function oo(s,c){try{var l=s.j;if(l.I!=0&&(l.g==s||ao(l.h,s))){if(!s.L&&ao(l.h,s)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var v=f;if(v[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<s.F)oi(l),ii(l);else break e;fo(l),Ae(18)}}else l.xa=v[1],0<l.xa-l.K&&v[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=Qn(d(l.Va,l),6e3));dl(l.h)<=1&&l.ta&&(l.ta=void 0)}else Lt(l,11)}else if((s.L||l.g==s)&&oi(l),!g(c))for(v=l.Ba.g.parse(c),c=0;c<v.length;c++){let Q=v[c],ue=Q[0];if(!(ue<=l.K))if(l.K=ue,Q=Q[1],l.I==2)if(Q[0]=="c"){l.M=Q[1],l.ba=Q[2];let Be=Q[3];Be!=null&&(l.ka=Be,l.j.info("VER="+l.ka));let Mt=Q[4];Mt!=null&&(l.za=Mt,l.j.info("SVER="+l.za));let wt=Q[5];wt!=null&&typeof wt=="number"&&wt>0&&(f=1.5*wt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let Et=s.g;if(Et){let ci=Et.g?Et.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ci){var b=f.h;b.g||ci.indexOf("spdy")==-1&&ci.indexOf("quic")==-1&&ci.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(co(b,b.h),b.h=null))}if(f.G){let mo=Et.g?Et.g.getResponseHeader("X-HTTP-Session-Id"):null;mo&&(f.wa=mo,Y(f.J,f.G,mo))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-s.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var C=s;if(f.na=Ml(f,f.L?f.ba:null,f.W),C.L){fl(f.h,C);var q=C,ce=f.O;ce&&(q.H=ce),q.D&&(so(q),Zr(q)),f.g=C}else Nl(f);l.i.length>0&&si(l)}else Q[0]!="stop"&&Q[0]!="close"||Lt(l,7);else l.I==3&&(Q[0]=="stop"||Q[0]=="close"?Q[0]=="stop"?Lt(l,7):ho(l):Q[0]!="noop"&&l.l&&l.l.qa(Q),l.A=0)}}Hn(4)}catch{}}var Mm=class{constructor(s,c){this.g=s,this.map=c}};function ll(s){this.l=s||10,a.PerformanceNavigationTiming?(s=a.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function hl(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function dl(s){return s.h?1:s.g?s.g.size:0}function ao(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function co(s,c){s.g?s.g.add(c):s.h=c}function fl(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}ll.prototype.cancel=function(){if(this.i=pl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function pl(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.G);return c}return R(s.i)}var ml=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Fm(s,c){if(s){s=s.split("&");for(let l=0;l<s.length;l++){let f=s[l].indexOf("="),v,b=null;f>=0?(v=s[l].substring(0,f),b=s[l].substring(f+1)):v=s[l],c(v,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function _t(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;s instanceof _t?(this.l=s.l,Zn(this,s.j),this.o=s.o,this.g=s.g,er(this,s.u),this.h=s.h,uo(this,El(s.i)),this.m=s.m):s&&(c=String(s).match(ml))?(this.l=!1,Zn(this,c[1]||"",!0),this.o=tr(c[2]||""),this.g=tr(c[3]||"",!0),er(this,c[4]),this.h=tr(c[5]||"",!0),uo(this,c[6]||"",!0),this.m=tr(c[7]||"")):(this.l=!1,this.i=new rr(null,this.l))}_t.prototype.toString=function(){let s=[];var c=this.j;c&&s.push(nr(c,gl,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(nr(c,gl,!0),"@"),s.push(Yn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&s.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(nr(l,l.charAt(0)=="/"?Bm:qm,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",nr(l,jm)),s.join("")},_t.prototype.resolve=function(s){let c=qe(this),l=!!s.j;l?Zn(c,s.j):l=!!s.o,l?c.o=s.o:l=!!s.g,l?c.g=s.g:l=s.u!=null;var f=s.h;if(l)er(c,s.u);else if(l=!!s.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var v=c.h.lastIndexOf("/");v!=-1&&(f=c.h.slice(0,v+1)+f)}if(v=f,v==".."||v==".")f="";else if(v.indexOf("./")!=-1||v.indexOf("/.")!=-1){f=v.lastIndexOf("/",0)==0,v=v.split("/");let b=[];for(let C=0;C<v.length;){let q=v[C++];q=="."?f&&C==v.length&&b.push(""):q==".."?((b.length>1||b.length==1&&b[0]!="")&&b.pop(),f&&C==v.length&&b.push("")):(b.push(q),f=!0)}f=b.join("/")}else f=v}return l?c.h=f:l=s.i.toString()!=="",l?uo(c,El(s.i)):l=!!s.m,l&&(c.m=s.m),c};function qe(s){return new _t(s)}function Zn(s,c,l){s.j=l?tr(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function er(s,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);s.u=c}else s.u=null}function uo(s,c,l){c instanceof rr?(s.i=c,$m(s.i,s.l)):(l||(c=nr(c,zm)),s.i=new rr(c,s.l))}function Y(s,c,l){s.i.set(c,l)}function ei(s){return Y(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function tr(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function nr(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,Um),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function Um(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var gl=/[#\/\?@]/g,qm=/[#\?:]/g,Bm=/[#\?]/g,zm=/[#\?@]/g,jm=/#/g;function rr(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function xt(s){s.g||(s.g=new Map,s.h=0,s.i&&Fm(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=rr.prototype,n.add=function(s,c){xt(this),this.i=null,s=fn(this,s);let l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function _l(s,c){xt(s),c=fn(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function yl(s,c){return xt(s),c=fn(s,c),s.g.has(c)}n.forEach=function(s,c){xt(this),this.g.forEach(function(l,f){l.forEach(function(v){s.call(c,v,f,this)},this)},this)};function Il(s,c){xt(s);let l=[];if(typeof c=="string")yl(s,c)&&(l=l.concat(s.g.get(fn(s,c))));else for(s=Array.from(s.g.values()),c=0;c<s.length;c++)l=l.concat(s[c]);return l}n.set=function(s,c){return xt(this),this.i=null,s=fn(this,s),yl(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=Il(this,s),s.length>0?String(s[0]):c):c};function wl(s,c,l){_l(s,c),l.length>0&&(s.i=null,s.g.set(fn(s,c),R(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];let v=Yn(l);l=Il(this,l);for(let b=0;b<l.length;b++){let C=v;l[b]!==""&&(C+="="+Yn(l[b])),s.push(C)}}return this.i=s.join("&")};function El(s){let c=new rr;return c.i=s.i,s.g&&(c.g=new Map(s.g),c.h=s.h),c}function fn(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function $m(s,c){c&&!s.j&&(xt(s),s.i=null,s.g.forEach(function(l,f){let v=f.toLowerCase();f!=v&&(_l(this,f),wl(this,v,l))},s)),s.j=c}function Gm(s,c){let l=new Jn;if(a.Image){let f=new Image;f.onload=p(yt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(yt,l,"TestLoadImage: error",!1,c,f),f.onabort=p(yt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(yt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function Wm(s,c){let l=new Jn,f=new AbortController,v=setTimeout(()=>{f.abort(),yt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(b=>{clearTimeout(v),b.ok?yt(l,"TestPingServer: ok",!0,c):yt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(v),yt(l,"TestPingServer: error",!1,c)})}function yt(s,c,l,f,v){try{v&&(v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null),f(l)}catch{}}function Km(){this.g=new Cm}function ti(s){this.i=s.Sb||null,this.h=s.ab||!1}y(ti,Yu),ti.prototype.g=function(){return new ni(this.i,this.h)};function ni(s,c){Ee.call(this),this.H=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}y(ni,Ee),n=ni.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=c,this.readyState=1,sr(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(c.body=s),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ir(this)),this.readyState=0},n.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,sr(this)),this.g&&(this.readyState=3,sr(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Tl(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function Tl(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}n.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?ir(this):sr(this),this.readyState==3&&Tl(this)}},n.Oa=function(s){this.g&&(this.response=this.responseText=s,ir(this))},n.Na=function(s){this.g&&(this.response=s,ir(this))},n.ga=function(){this.g&&ir(this)};function ir(s){s.readyState=4,s.l=null,s.j=null,s.B=null,sr(s)}n.setRequestHeader=function(s,c){this.A.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function sr(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(ni.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function vl(s){let c="";return Hr(s,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function lo(s,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=vl(l),typeof s=="string"?l!=null&&Yn(l):Y(s,c,l))}function Z(s){Ee.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}y(Z,Ee);var Hm=/^https?$/i,Qm=["POST","PUT"];n=Z.prototype,n.Fa=function(s){this.H=s},n.ea=function(s,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():il.g(),this.g.onreadystatechange=T(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(b){Al(this,b);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var v in f)l.set(v,f[v]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let b of f.keys())l.set(b,f.get(b));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(b=>b.toLowerCase()=="content-type"),v=a.FormData&&s instanceof a.FormData,!(Array.prototype.indexOf.call(Qm,c,void 0)>=0)||f||v||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,C]of l)this.g.setRequestHeader(b,C);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(b){Al(this,b)}};function Al(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.o=5,bl(s),ri(s)}function bl(s){s.A||(s.A=!0,ve(s,"complete"),ve(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,ve(this,"complete"),ve(this,"abort"),ri(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ri(this,!0)),Z.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Sl(this):this.Xa())},n.Xa=function(){Sl(this)};function Sl(s){if(s.h&&typeof o<"u"){if(s.v&&It(s)==4)setTimeout(s.Ca.bind(s),0);else if(ve(s,"readystatechange"),It(s)==4){s.h=!1;try{let b=s.ca();e:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=b===0){let C=String(s.D).match(ml)[1]||null;!C&&a.self&&a.self.location&&(C=a.self.location.protocol.slice(0,-1)),f=!Hm.test(C?C.toLowerCase():"")}l=f}if(l)ve(s,"complete"),ve(s,"success");else{s.o=6;try{var v=It(s)>2?s.g.statusText:""}catch{v=""}s.l=v+" ["+s.ca()+"]",bl(s)}}finally{ri(s)}}}}function ri(s,c){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);let l=s.g;s.g=null,c||ve(s,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function It(s){return s.g?s.g.readyState:0}n.ca=function(){try{return It(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),Pm(c)}};function Rl(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Jm(s){let c={};s=(s.g&&It(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(g(s[f]))continue;var l=Om(s[f]);let v=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let b=c[v]||[];c[v]=b,b.push(l)}vm(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function or(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function Pl(s){this.za=0,this.i=[],this.j=new Jn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=or("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=or("baseRetryDelayMs",5e3,s),this.Za=or("retryDelaySeedMs",1e4,s),this.Ta=or("forwardChannelMaxRetries",2,s),this.va=or("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new ll(s&&s.concurrentRequestLimit),this.Ba=new Km,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Pl.prototype,n.ka=8,n.I=1,n.connect=function(s,c,l,f){Ae(0),this.W=s,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=Ml(this,null,this.W),si(this)};function ho(s){if(Cl(s),s.I==3){var c=s.V++,l=qe(s.J);if(Y(l,"SID",s.M),Y(l,"RID",c),Y(l,"TYPE","terminate"),ar(s,l),c=new gt(s,s.j,c),c.M=2,c.A=ei(qe(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=Fl(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Zr(c)}Ll(s)}function ii(s){s.g&&(po(s),s.g.cancel(),s.g=null)}function Cl(s){ii(s),s.v&&(a.clearTimeout(s.v),s.v=null),oi(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&a.clearTimeout(s.m),s.m=null)}function si(s){if(!hl(s.h)&&!s.m){s.m=!0;var c=s.Ea;Le||m(),me||(Le(),me=!0),w.add(c,s),s.D=0}}function Ym(s,c){return dl(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=c.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=Qn(d(s.Ea,s,c),xl(s,s.D)),s.D++,!0)}n.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;let v=new gt(this,this.j,s),b=this.o;if(this.U&&(b?(b=qu(b),zu(b,this.U)):b=this.U),this.u!==null||this.R||(v.J=b,b=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Dl(this,v,c),l=qe(this.J),Y(l,"RID",s),Y(l,"CVER",22),this.G&&Y(l,"X-HTTP-Session-Id",this.G),ar(this,l),b&&(this.R?c="headers="+Yn(vl(b))+"&"+c:this.u&&lo(l,this.u,b)),co(this.h,v),this.Ra&&Y(l,"TYPE","init"),this.S?(Y(l,"$req",c),Y(l,"SID","null"),v.U=!0,io(v,l,null)):io(v,l,c),this.I=2}}else this.I==3&&(s?kl(this,s):this.i.length==0||hl(this.h)||kl(this))};function kl(s,c){var l;c?l=c.l:l=s.V++;let f=qe(s.J);Y(f,"SID",s.M),Y(f,"RID",l),Y(f,"AID",s.K),ar(s,f),s.u&&s.o&&lo(f,s.u,s.o),l=new gt(s,s.j,l,s.D+1),s.u===null&&(l.J=s.o),c&&(s.i=c.G.concat(s.i)),c=Dl(s,l,1e3),l.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),co(s.h,l),io(l,f,c)}function ar(s,c){s.H&&Hr(s.H,function(l,f){Y(c,f,l)}),s.l&&Hr({},function(l,f){Y(c,f,l)})}function Dl(s,c,l){l=Math.min(s.i.length,l);let f=s.l?d(s.l.Ka,s.l,s):null;e:{var v=s.i;let q=-1;for(;;){let ce=["count="+l];q==-1?l>0?(q=v[0].g,ce.push("ofs="+q)):q=0:ce.push("ofs="+q);let Q=!0;for(let ue=0;ue<l;ue++){var b=v[ue].g;let Be=v[ue].map;if(b-=q,b<0)q=Math.max(0,v[ue].g-100),Q=!1;else try{b="req"+b+"_"||"";try{var C=Be instanceof Map?Be:Object.entries(Be);for(let[Mt,wt]of C){let Et=wt;u(wt)&&(Et=Zs(wt)),ce.push(b+Mt+"="+encodeURIComponent(Et))}}catch(Mt){throw ce.push(b+"type="+encodeURIComponent("_badmap")),Mt}}catch{f&&f(Be)}}if(Q){C=ce.join("&");break e}}C=void 0}return s=s.i.splice(0,l),c.G=s,C}function Nl(s){if(!s.g&&!s.v){s.Y=1;var c=s.Da;Le||m(),me||(Le(),me=!0),w.add(c,s),s.A=0}}function fo(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=Qn(d(s.Da,s),xl(s,s.A)),s.A++,!0)}n.Da=function(){if(this.v=null,Vl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=Qn(d(this.Wa,this),s)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ae(10),ii(this),Vl(this))};function po(s){s.B!=null&&(a.clearTimeout(s.B),s.B=null)}function Vl(s){s.g=new gt(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var c=qe(s.na);Y(c,"RID","rpc"),Y(c,"SID",s.M),Y(c,"AID",s.K),Y(c,"CI",s.F?"0":"1"),!s.F&&s.ia&&Y(c,"TO",s.ia),Y(c,"TYPE","xmlhttp"),ar(s,c),s.u&&s.o&&lo(c,s.u,s.o),s.O&&(s.g.H=s.O);var l=s.g;s=s.ba,l.M=1,l.A=ei(qe(c)),l.u=null,l.R=!0,al(l,s)}n.Va=function(){this.C!=null&&(this.C=null,ii(this),fo(this),Ae(19))};function oi(s){s.C!=null&&(a.clearTimeout(s.C),s.C=null)}function Ol(s,c){var l=null;if(s.g==c){oi(s),po(s),s.g=null;var f=2}else if(ao(s.h,c))l=c.G,fl(s.h,c),f=1;else return;if(s.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var v=s.D;f=Yr(),ve(f,new nl(f,l)),si(s)}else Nl(s);else if(v=c.m,v==3||v==0&&c.X>0||!(f==1&&Ym(s,c)||f==2&&fo(s)))switch(l&&l.length>0&&(c=s.h,c.i=c.i.concat(l)),v){case 1:Lt(s,5);break;case 4:Lt(s,10);break;case 3:Lt(s,6);break;default:Lt(s,2)}}}function xl(s,c){let l=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(l*=2),l*c}function Lt(s,c){if(s.j.info("Error code "+c),c==2){var l=d(s.bb,s),f=s.Ua;let v=!f;f=new _t(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Zn(f,"https"),ei(f),v?Gm(f.toString(),l):Wm(f.toString(),l)}else Ae(2);s.I=0,s.l&&s.l.pa(c),Ll(s),Cl(s)}n.bb=function(s){s?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))};function Ll(s){if(s.I=0,s.ja=[],s.l){let c=pl(s.h);(c.length!=0||s.i.length!=0)&&(N(s.ja,c),N(s.ja,s.i),s.h.i.length=0,R(s.i),s.i.length=0),s.l.oa()}}function Ml(s,c,l){var f=l instanceof _t?qe(l):new _t(l);if(f.g!="")c&&(f.g=c+"."+f.g),er(f,f.u);else{var v=a.location;f=v.protocol,c=c?c+"."+v.hostname:v.hostname,v=+v.port;let b=new _t(null);f&&Zn(b,f),c&&(b.g=c),v&&er(b,v),l&&(b.h=l),f=b}return l=s.G,c=s.wa,l&&c&&Y(f,l,c),Y(f,"VER",s.ka),ar(s,f),f}function Fl(s,c,l){if(c&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Aa&&!s.ma?new Z(new ti({ab:l})):new Z(s.ma),c.Fa(s.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ul(){}n=Ul.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ai(){}ai.prototype.g=function(s,c){return new ke(s,c)};function ke(s,c){Ee.call(this),this.g=new Pl(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(s?s["X-WebChannel-Client-Profile"]=c.sa:s={"X-WebChannel-Client-Profile":c.sa}),this.g.U=s,(s=c&&c.Qb)&&!g(s)&&(this.g.u=s),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new pn(this)}y(ke,Ee),ke.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ke.prototype.close=function(){ho(this.g)},ke.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.v&&(l={},l.__data__=Zs(s),s=l);c.i.push(new Mm(c.Ya++,s)),c.I==3&&si(c)},ke.prototype.N=function(){this.g.l=null,delete this.j,ho(this.g),delete this.g,ke.Z.N.call(this)};function ql(s){eo.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}y(ql,eo);function Bl(){to.call(this),this.status=1}y(Bl,to);function pn(s){this.g=s}y(pn,Ul),pn.prototype.ra=function(){ve(this.g,"a")},pn.prototype.qa=function(s){ve(this.g,new ql(s))},pn.prototype.pa=function(s){ve(this.g,new Bl)},pn.prototype.oa=function(){ve(this.g,"b")},ai.prototype.createWebChannel=ai.prototype.g,ke.prototype.send=ke.prototype.o,ke.prototype.open=ke.prototype.m,ke.prototype.close=ke.prototype.close,ba=ot.createWebChannelTransport=function(){return new ai},Aa=ot.getStatEventTarget=function(){return Yr()},va=ot.Event=Vt,zi=ot.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Xr.NO_ERROR=0,Xr.TIMEOUT=8,Xr.HTTP_ERROR=6,Er=ot.ErrorCode=Xr,rl.COMPLETE="complete",Ta=ot.EventType=rl,Xu.EventType=Kn,Kn.OPEN="a",Kn.CLOSE="b",Kn.ERROR="c",Kn.MESSAGE="d",Ee.prototype.listen=Ee.prototype.J,In=ot.WebChannel=Xu,rI=ot.FetchXmlHttpFactory=ti,Z.prototype.listenOnce=Z.prototype.K,Z.prototype.getLastError=Z.prototype.Ha,Z.prototype.getLastErrorCode=Z.prototype.ya,Z.prototype.getStatus=Z.prototype.ca,Z.prototype.getResponseJson=Z.prototype.La,Z.prototype.getResponseText=Z.prototype.la,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Fa,Ea=ot.XhrIo=Z}).apply(typeof Bi<"u"?Bi:typeof self<"u"?self:typeof window<"u"?window:{});var fe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};fe.UNAUTHENTICATED=new fe(null),fe.GOOGLE_CREDENTIALS=new fe("google-credentials-uid"),fe.FIRST_PARTY=new fe("first-party-uid"),fe.MOCK_USER=new fe("mock-user");var Fn="12.9.0";function af(n){Fn=n}var Wt=new ze("@firebase/firestore");function wn(){return Wt.logLevel}function k(n,...e){if(Wt.logLevel<=z.DEBUG){let t=e.map(ru);Wt.debug(`Firestore (${Fn}): ${n}`,...t)}}function ct(n,...e){if(Wt.logLevel<=z.ERROR){let t=e.map(ru);Wt.error(`Firestore (${Fn}): ${n}`,...t)}}function ut(n,...e){if(Wt.logLevel<=z.WARN){let t=e.map(ru);Wt.warn(`Firestore (${Fn}): ${n}`,...t)}}function ru(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function L(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,cf(n,r,t)}function cf(n,e,t){let r=`FIRESTORE (${Fn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ct(r),new Error(r)}function H(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||cf(e,i,r)}function F(n,e){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends ge{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ke=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Qi=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ji=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(fe.UNAUTHENTICATED))}shutdown(){}},Da=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Yi=class{constructor(e){this.t=e,this.currentUser=fe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){H(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new Ke;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ke,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(async()=>{await h.promise,await i(this.currentUser)})},u=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ke)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(H(typeof r.accessToken=="string",31837,{l:r}),new Qi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return H(e===null||typeof e=="string",2055,{h:e}),new fe(e)}},Na=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=fe.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}},Va=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Na(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(fe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Xi=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Zi=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Pe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){H(this.o===void 0,3512);let r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Xi(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Xi(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function iI(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Kt=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=iI(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function G(n,e){return n<e?-1:n>e?1:0}function Oa(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),o=e.charAt(r);if(i!==o)return Sa(i)===Sa(o)?G(i,o):Sa(i)?1:-1}return G(n.length,e.length)}var sI=55296,oI=57343;function Sa(n){let e=n.charCodeAt(0);return e>=sI&&e<=oI}function Rn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Td="__name__",es=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&L(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return G(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Oa(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return st.fromString(e.substring(4,e.length-2))}},ee=class n extends es{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},aI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ce=class n extends es{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return aI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Td}static keyField(){return new n([Td])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new V(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new V(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var x=class n{constructor(e){this.path=e}static fromPath(e){return new n(ee.fromString(e))}static fromName(e){return new n(ee.fromString(e).popFirst(5))}static empty(){return new n(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ee.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ee(e.slice()))}};function cI(n,e,t){if(!t)throw new V(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function uf(n,e,t,r){if(e===!0&&r===!0)throw new V(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function vd(n){if(!x.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lf(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Cs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function rn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Cs(n);throw new V(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function re(n,e){let t={typeString:n};return e&&(t.value=e),t}function Un(n,e){if(!lf(n))throw new V(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new V(S.INVALID_ARGUMENT,t);return!0}var Ad=-62135596800,bd=1e6,ie=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*bd);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ad)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/bd}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Un(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Ad;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ie._jsonSchemaVersion="firestore/timestamp/1.0",ie._jsonSchema={type:re("string",ie._jsonSchemaVersion),seconds:re("number"),nanoseconds:re("number")};var U=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new ie(0,0))}static max(){return new n(new ie(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Rr=-1,ts=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};ts.UNKNOWN_ID=-1;function uI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=U.fromTimestamp(r===1e9?new ie(t+1,0):new ie(t,r));return new Ht(i,x.empty(),e)}function lI(n){return new Ht(n.readTime,n.key,Rr)}var Ht=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(U.min(),x.empty(),Rr)}static max(){return new n(U.max(),x.empty(),Rr)}};function hI(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=x.comparator(n.documentKey,e.documentKey),t!==0?t:G(n.largestBatchId,e.largestBatchId))}var dI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",xa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};async function qn(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==dI)throw n;k("LocalStore","Unexpectedly lost primary lease")}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function fI(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Bn(n){return n.name==="IndexedDbTransactionError"}var iu=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),su=-1;function ks(n){return n==null}function Pr(n){return n===0&&1/n==-1/0}function pI(n){return typeof n=="number"&&Number.isInteger(n)&&!Pr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var hf="";function mI(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Sd(e)),e=gI(n.get(t),e);return Sd(e)}function gI(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case hf:t+="";break;default:t+=o}}return t}function Sd(n){return n+hf+""}var _I="remoteDocuments",df="owner";var ff="mutationQueues";var pf="mutations";var mf="documentMutations",yI="remoteDocumentsV14";var gf="remoteDocumentGlobal";var _f="targets";var yf="targetDocuments";var If="targetGlobal",wf="collectionParents";var Ef="clientMetadata";var Tf="bundles";var vf="namedQueries";var II="indexConfiguration";var wI="indexState";var EI="indexEntries";var Af="documentOverlays";var TI="globals";var vI=[ff,pf,mf,_I,_f,df,If,yf,Ef,gf,wf,Tf,vf],zA=[...vI,Af],AI=[ff,pf,mf,yI,_f,df,If,yf,Ef,gf,wf,Tf,vf,Af],bI=AI,SI=[...bI,II,wI,EI];var jA=[...SI,TI];function Rd(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function sn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function bf(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var te=class n{constructor(e,t){this.comparator=e,this.root=t||He.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,He.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,He.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new An(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new An(this.root,e,this.comparator,!1)}getReverseIterator(){return new An(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new An(this.root,e,this.comparator,!0)}},An=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},He=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw L(27949);return e+(this.isRed()?0:1)}};He.EMPTY=null,He.RED=!0,He.BLACK=!1;He.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new He(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var pe=class n{constructor(e){this.comparator=e,this.data=new te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ns(this.data.getIterator())}getIteratorFrom(e){return new ns(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ns=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var We=class n{constructor(e){this.fields=e,e.sort(Ce.comparator)}static empty(){return new n([])}unionWith(e){let t=new pe(Ce.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Rn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var rs=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ie=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new rs("Invalid base64 string: "+o):o}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ie.EMPTY_BYTE_STRING=new Ie("");var RI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lt(n){if(H(!!n,39018),typeof n=="string"){let e=0,t=RI.exec(n);if(H(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:X(n.seconds),nanos:X(n.nanos)}}function X(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ht(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}var Sf="server_timestamp",Rf="__type__",Pf="__previous_value__",Cf="__local_write_time__";function Ds(n){return(n?.mapValue?.fields||{})[Rf]?.stringValue===Sf}function Ns(n){let e=n.mapValue.fields[Pf];return Ds(e)?Ns(e):e}function Cr(n){let e=lt(n.mapValue.fields[Cf].timestampValue);return new ie(e.seconds,e.nanos)}var La=class{constructor(e,t,r,i,o,a,u,h,d,p,y){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p,this.apiKey=y}},is="(default)",kr=class n{constructor(e,t){this.projectId=e,this.database=t||is}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===is}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function kf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new V(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kr(n.options.projectId,e)}var ou="__type__",Df="__max__",ji={mapValue:{fields:{__type__:{stringValue:Df}}}},au="__vector__",Pn="value";function kt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ds(n)?4:Vf(n)?9007199254740991:Nf(n)?10:11:L(28295,{value:n})}function Ze(n,e){if(n===e)return!0;let t=kt(n);if(t!==kt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Cr(n).isEqual(Cr(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=lt(i.timestampValue),u=lt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,o){return ht(i.bytesValue).isEqual(ht(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,o){return X(i.geoPointValue.latitude)===X(o.geoPointValue.latitude)&&X(i.geoPointValue.longitude)===X(o.geoPointValue.longitude)})(n,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return X(i.integerValue)===X(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=X(i.doubleValue),u=X(o.doubleValue);return a===u?Pr(a)===Pr(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return Rn(n.arrayValue.values||[],e.arrayValue.values||[],Ze);case 10:case 11:return(function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Rd(a)!==Rd(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Ze(a[h],u[h])))return!1;return!0})(n,e);default:return L(52216,{left:n})}}function Dr(n,e){return(n.values||[]).find(t=>Ze(t,e))!==void 0}function Cn(n,e){if(n===e)return 0;let t=kt(n),r=kt(e);if(t!==r)return G(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,e.booleanValue);case 2:return(function(o,a){let u=X(o.integerValue||o.doubleValue),h=X(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return Pd(n.timestampValue,e.timestampValue);case 4:return Pd(Cr(n),Cr(e));case 5:return Oa(n.stringValue,e.stringValue);case 6:return(function(o,a){let u=ht(o),h=ht(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){let u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){let p=G(u[d],h[d]);if(p!==0)return p}return G(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){let u=G(X(o.latitude),X(a.latitude));return u!==0?u:G(X(o.longitude),X(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Cd(n.arrayValue,e.arrayValue);case 10:return(function(o,a){let u=o.fields||{},h=a.fields||{},d=u[Pn]?.arrayValue,p=h[Pn]?.arrayValue,y=G(d?.values?.length||0,p?.values?.length||0);return y!==0?y:Cd(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ji.mapValue&&a===ji.mapValue)return 0;if(o===ji.mapValue)return 1;if(a===ji.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let y=0;y<h.length&&y<p.length;++y){let T=Oa(h[y],p[y]);if(T!==0)return T;let R=Cn(u[h[y]],d[p[y]]);if(R!==0)return R}return G(h.length,p.length)})(n.mapValue,e.mapValue);default:throw L(23264,{he:t})}}function Pd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return G(n,e);let t=lt(n),r=lt(e),i=G(t.seconds,r.seconds);return i!==0?i:G(t.nanos,r.nanos)}function Cd(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=Cn(t[i],r[i]);if(o)return o}return G(t.length,r.length)}function kn(n){return Ma(n)}function Ma(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=lt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return ht(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return x.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Ma(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Ma(t.fields[a])}`;return i+"}"})(n.mapValue):L(61005,{value:n})}function Wi(n){switch(kt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Ns(n);return e?16+Wi(e):16;case 5:return 2*n.stringValue.length;case 6:return ht(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,o)=>i+Wi(o),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return sn(r.fields,(o,a)=>{i+=o.length+Wi(a)}),i})(n.mapValue);default:throw L(13486,{value:n})}}function Fa(n){return!!n&&"integerValue"in n}function cu(n){return!!n&&"arrayValue"in n}function kd(n){return!!n&&"nullValue"in n}function Dd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ki(n){return!!n&&"mapValue"in n}function Nf(n){return(n?.mapValue?.fields||{})[ou]?.stringValue===au}function Ar(n){if(n.geoPointValue)return{geoPointValue:B({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:B({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return sn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ar(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ar(n.arrayValue.values[t]);return e}return B({},n)}function Vf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Df}var GA={mapValue:{fields:{[ou]:{stringValue:au},[Pn]:{arrayValue:{}}}}};var xe=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ki(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ar(t)}setAll(e){let t=Ce.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=Ar(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());Ki(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ze(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ki(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){sn(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(Ar(this.value))}};function Of(n){let e=[];return sn(n.fields,(t,r)=>{let i=new Ce([t]);if(Ki(r)){let o=Of(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new We(e)}var Fe=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,U.min(),U.min(),U.min(),xe.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,U.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,U.min(),U.min(),xe.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,U.min(),U.min(),xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Qt=class{constructor(e,t){this.position=e,this.inclusive=t}};function Nd(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=x.comparator(x.fromName(a.referenceValue),t.key):r=Cn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Vd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ze(n.position[t],e.position[t]))return!1;return!0}var Jt=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function PI(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ss=class{},ae=class n extends ss{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new qa(e,t,r):t==="array-contains"?new ja(e,r):t==="in"?new $a(e,r):t==="not-in"?new Ga(e,r):t==="array-contains-any"?new Wa(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Ba(e,r):new za(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Cn(t,this.value)):t!==null&&kt(this.value)===kt(t)&&this.matchesComparison(Cn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ue=class n extends ss{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return xf(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function xf(n){return n.op==="and"}function Lf(n){return CI(n)&&xf(n)}function CI(n){for(let e of n.filters)if(e instanceof Ue)return!1;return!0}function Ua(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+kn(n.value);if(Lf(n))return n.filters.map(e=>Ua(e)).join(",");{let e=n.filters.map(t=>Ua(t)).join(",");return`${n.op}(${e})`}}function Mf(n,e){return n instanceof ae?(function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&Ze(r.value,i.value)})(n,e):n instanceof Ue?(function(r,i){return i instanceof Ue&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&Mf(a,i.filters[u]),!0):!1})(n,e):void L(19439)}function Ff(n){return n instanceof ae?(function(t){return`${t.field.canonicalString()} ${t.op} ${kn(t.value)}`})(n):n instanceof Ue?(function(t){return t.op.toString()+" {"+t.getFilters().map(Ff).join(" ,")+"}"})(n):"Filter"}var qa=class extends ae{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){let t=x.comparator(e.key,this.key);return this.matchesComparison(t)}},Ba=class extends ae{constructor(e,t){super(e,"in",t),this.keys=Uf("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},za=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=Uf("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Uf(n,e){return(e.arrayValue?.values||[]).map(t=>x.fromName(t.referenceValue))}var ja=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cu(t)&&Dr(t.arrayValue,this.value)}},$a=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Dr(this.value.arrayValue,t)}},Ga=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Dr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Dr(this.value.arrayValue,t)}},Wa=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!cu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Dr(this.value.arrayValue,r))}};var Ka=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}};function Od(n,e=null,t=[],r=[],i=null,o=null,a=null){return new Ka(n,e,t,r,i,o,a)}function uu(n){let e=F(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ua(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),ks(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>kn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>kn(r)).join(",")),e.Te=t}return e.Te}function lu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!PI(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Mf(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Vd(n.startAt,e.startAt)&&Vd(n.endAt,e.endAt)}function Ha(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Dn=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}};function kI(n,e,t,r,i,o,a,u){return new Dn(n,e,t,r,i,o,a,u)}function Vs(n){return new Dn(n)}function xd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function DI(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function qf(n){return n.collectionGroup!==null}function bn(n){let e=F(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new pe(Ce.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Jt(o,r))}),t.has(Ce.keyField().canonicalString())||e.Ie.push(new Jt(Ce.keyField(),r))}return e.Ie}function Qe(n){let e=F(n);return e.Ee||(e.Ee=NI(e,bn(n))),e.Ee}function NI(n,e){if(n.limitType==="F")return Od(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Jt(i.field,o)});let t=n.endAt?new Qt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Qt(n.startAt.position,n.startAt.inclusive):null;return Od(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function os(n,e,t){return new Dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Os(n,e){return lu(Qe(n),Qe(e))&&n.limitType===e.limitType}function Bf(n){return`${uu(Qe(n))}|lt:${n.limitType}`}function En(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Ff(i)).join(", ")}]`),ks(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>kn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>kn(i)).join(",")),`Target(${r})`})(Qe(n))}; limitType=${n.limitType})`}function xs(n,e){return e.isFoundDocument()&&(function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):x.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,i){for(let o of bn(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,u,h){let d=Nd(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,bn(r),i)||r.endAt&&!(function(a,u,h){let d=Nd(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,bn(r),i))})(n,e)}function VI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function zf(n){return(e,t)=>{let r=!1;for(let i of bn(n)){let o=OI(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function OI(n,e,t){let r=n.field.isKeyField()?x.comparator(e.key,t.key):(function(o,a,u){let h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Cn(h,d):L(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}var dt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){sn(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return bf(this.inner)}size(){return this.innerSize}};var xI=new te(x.comparator);function ft(){return xI}var jf=new te(x.comparator);function vr(...n){let e=jf;for(let t of n)e=e.insert(t.key,t);return e}function $f(n){let e=jf;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function $t(){return br()}function Gf(){return br()}function br(){return new dt(n=>n.toString(),(n,e)=>n.isEqual(e))}var LI=new te(x.comparator),MI=new pe(x.comparator);function j(...n){let e=MI;for(let t of n)e=e.add(t);return e}var FI=new pe(G);function UI(){return FI}function hu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(e)?"-0":e}}function Wf(n){return{integerValue:""+n}}function qI(n,e){return pI(e)?Wf(e):hu(n,e)}var Nn=class{constructor(){this._=void 0}};function BI(n,e,t){return n instanceof Vn?(function(i,o){let a={fields:{[Rf]:{stringValue:Sf},[Cf]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Ds(o)&&(o=Ns(o)),o&&(a.fields[Pf]=o),{mapValue:a}})(t,e):n instanceof Yt?Hf(n,e):n instanceof Xt?Qf(n,e):(function(i,o){let a=Kf(i,o),u=Ld(a)+Ld(i.Ae);return Fa(a)&&Fa(i.Ae)?Wf(u):hu(i.serializer,u)})(n,e)}function zI(n,e,t){return n instanceof Yt?Hf(n,e):n instanceof Xt?Qf(n,e):t}function Kf(n,e){return n instanceof On?(function(r){return Fa(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}var Vn=class extends Nn{},Yt=class extends Nn{constructor(e){super(),this.elements=e}};function Hf(n,e){let t=Jf(e);for(let r of n.elements)t.some(i=>Ze(i,r))||t.push(r);return{arrayValue:{values:t}}}var Xt=class extends Nn{constructor(e){super(),this.elements=e}};function Qf(n,e){let t=Jf(e);for(let r of n.elements)t=t.filter(i=>!Ze(i,r));return{arrayValue:{values:t}}}var On=class extends Nn{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function Ld(n){return X(n.integerValue||n.doubleValue)}function Jf(n){return cu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function jI(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Yt&&i instanceof Yt||r instanceof Xt&&i instanceof Xt?Rn(r.elements,i.elements,Ze):r instanceof On&&i instanceof On?Ze(r.Ae,i.Ae):r instanceof Vn&&i instanceof Vn})(n.transform,e.transform)}var Qa=class{constructor(e,t){this.version=e,this.transformResults=t}},Ct=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Hi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var xn=class{};function Yf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Nr(n.key,Ct.none()):new Zt(n.key,n.data,Ct.none());{let t=n.data,r=xe.empty(),i=new pe(Ce.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new pt(n.key,r,new We(i.toArray()),Ct.none())}}function $I(n,e,t){n instanceof Zt?(function(i,o,a){let u=i.value.clone(),h=Fd(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof pt?(function(i,o,a){if(!Hi(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=Fd(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Xf(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Sr(n,e,t,r){return n instanceof Zt?(function(o,a,u,h){if(!Hi(o.precondition,a))return u;let d=o.value.clone(),p=Ud(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof pt?(function(o,a,u,h){if(!Hi(o.precondition,a))return u;let d=Ud(o.fieldTransforms,h,a),p=a.data;return p.setAll(Xf(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(y=>y.field))})(n,e,t,r):(function(o,a,u){return Hi(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function GI(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=Kf(r.transform,i||null);o!=null&&(t===null&&(t=xe.empty()),t.set(r.field,o))}return t||null}function Md(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Rn(r,i,(o,a)=>jI(o,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Zt=class extends xn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},pt=class extends xn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Xf(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Fd(n,e,t){let r=new Map;H(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,zI(a,u,t[i]))}return r}function Ud(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,BI(o,a,e))}return r}var Nr=class extends xn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ja=class extends xn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ya=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&$I(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Sr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Sr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Gf();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=Yf(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(U.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),j())}isEqual(e){return this.batchId===e.batchId&&Rn(this.mutations,e.mutations,(t,r)=>Md(t,r))&&Rn(this.baseMutations,e.baseMutations,(t,r)=>Md(t,r))}},Xa=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){H(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return LI})(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var Za=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ec=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var se,W;function WI(n){switch(n){case S.OK:return L(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function Zf(n){if(n===void 0)return ct("GRPC error has no .code"),S.UNKNOWN;switch(n){case se.OK:return S.OK;case se.CANCELLED:return S.CANCELLED;case se.UNKNOWN:return S.UNKNOWN;case se.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case se.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case se.INTERNAL:return S.INTERNAL;case se.UNAVAILABLE:return S.UNAVAILABLE;case se.UNAUTHENTICATED:return S.UNAUTHENTICATED;case se.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case se.NOT_FOUND:return S.NOT_FOUND;case se.ALREADY_EXISTS:return S.ALREADY_EXISTS;case se.PERMISSION_DENIED:return S.PERMISSION_DENIED;case se.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case se.ABORTED:return S.ABORTED;case se.OUT_OF_RANGE:return S.OUT_OF_RANGE;case se.UNIMPLEMENTED:return S.UNIMPLEMENTED;case se.DATA_LOSS:return S.DATA_LOSS;default:return L(39323,{code:n})}}(W=se||(se={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var KI=null;function HI(){return new TextEncoder}var QI=new st([4294967295,4294967295],0);function qd(n){let e=HI().encode(n),t=new wa;return t.update(e),new Uint8Array(t.digest())}function Bd(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new st([t,r],0),new st([i,o],0)]}var tc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Gt(`Invalid padding: ${t}`);if(r<0)throw new Gt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Gt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Gt(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=st.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(st.fromNumber(r)));return i.compare(QI)===1&&(i=new st([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=qd(e),[r,i]=Bd(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);if(!this.we(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;let t=qd(e),[r,i]=Bd(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);this.be(a)}}be(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Gt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var as=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Vr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(U.min(),i,new te(G),ft(),j())}},Vr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,j(),j(),j())}};var Sn=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=i}},cs=class{constructor(e,t){this.targetId=e,this.Ce=t}},us=class{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ls=class{constructor(){this.ve=0,this.Fe=zd(),this.Me=Ie.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=j(),t=j(),r=j();return this.Fe.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:L(38017,{changeType:o})}}),new Vr(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=zd()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,H(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}},nc=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=ft(),this.He=$i(),this.Je=$i(),this.Ze=new te(G)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:L(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let o=i.target;if(Ha(o))if(r===0){let a=new x(o.path);this.et(t,a,Fe.newNoDocument(a,U.min()))}else H(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}KI?.lt((function(p,y,T,R,N){let O={localCacheCount:p,existenceFilterCount:y.count,databaseId:T.database,projectId:T.projectId},D=y.unchangedNames;return D&&(O.bloomFilter={applied:N===0,hashCount:D?.hashCount??0,bitmapLength:D?.bits?.bitmap?.length??0,padding:D?.bits?.padding??0,mightContain:$=>R?.mightContain($)??!1}),O})(a,e.Ce,this.Ge.ht(),u,h))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=ht(r).toUint8Array()}catch(h){if(h instanceof rs)return ut("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new tc(a,i,o)}catch(h){return ut(h instanceof Gt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((o,a)=>{let u=this.ot(a);if(u){if(o.current&&Ha(u.target)){let h=new x(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Fe.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}});let r=j();this.Je.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));let i=new as(e,t,this.Ze,this.je,r);return this.je=ft(),this.He=$i(),this.Je=$i(),this.Ze=new te(G),i}Ye(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new ls,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new pe(G),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new pe(G),this.He=this.He.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ls),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function $i(){return new te(x.comparator)}function zd(){return new te(x.comparator)}var JI={asc:"ASCENDING",desc:"DESCENDING"},YI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},XI={and:"AND",or:"OR"},rc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function ic(n,e){return n.useProto3Json||ks(e)?e:{value:e}}function hs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ep(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ZI(n,e){return hs(n,e.toTimestamp())}function Je(n){return H(!!n,49232),U.fromTimestamp((function(t){let r=lt(t);return new ie(r.seconds,r.nanos)})(n))}function du(n,e){return sc(n,e).canonicalString()}function sc(n,e){let t=(function(i){return new ee(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function tp(n){let e=ee.fromString(n);return H(op(e),10190,{key:e.toString()}),e}function oc(n,e){return du(n.databaseId,e.path)}function Ra(n,e){let t=tp(e);if(t.get(1)!==n.databaseId.projectId)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new x(rp(t))}function np(n,e){return du(n.databaseId,e)}function ew(n){let e=tp(n);return e.length===4?ee.emptyPath():rp(e)}function ac(n){return new ee(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function rp(n){return H(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function jd(n,e,t){return{name:oc(n,e),fields:t.value.mapValue.fields}}function tw(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(H(p===void 0||typeof p=="string",58123),Ie.fromBase64String(p||"")):(H(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Ie.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){let p=d.code===void 0?S.UNKNOWN:Zf(d.code);return new V(p,d.message||"")})(a);t=new us(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ra(n,r.document.name),o=Je(r.document.updateTime),a=r.document.createTime?Je(r.document.createTime):U.min(),u=new xe({mapValue:{fields:r.document.fields}}),h=Fe.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Sn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ra(n,r.document),o=r.readTime?Je(r.readTime):U.min(),a=Fe.newNoDocument(i,o),u=r.removedTargetIds||[];t=new Sn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ra(n,r.document),o=r.removedTargetIds||[];t=new Sn([],o,i,null)}else{if(!("filter"in e))return L(11601,{Vt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new ec(i,o),u=r.targetId;t=new cs(u,a)}}return t}function nw(n,e){let t;if(e instanceof Zt)t={update:jd(n,e.key,e.value)};else if(e instanceof Nr)t={delete:oc(n,e.key)};else if(e instanceof pt)t={update:jd(n,e.key,e.data),updateMask:hw(e.fieldMask)};else{if(!(e instanceof Ja))return L(16599,{dt:e.type});t={verify:oc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(o,a){let u=a.transform;if(u instanceof Vn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Yt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Xt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof On)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw L(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:ZI(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,e.precondition)),t}function rw(n,e){return n&&n.length>0?(H(e!==void 0,14353),n.map(t=>(function(i,o){let a=i.updateTime?Je(i.updateTime):Je(o);return a.isEqual(U.min())&&(a=Je(o)),new Qa(a,i.transformResults||[])})(t,e))):[]}function iw(n,e){return{documents:[np(n,e.path)]}}function sw(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=np(n,i);let o=(function(d){if(d.length!==0)return sp(Ue.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);let a=(function(d){if(d.length!==0)return d.map(p=>(function(T){return{field:Tn(T.field),direction:cw(T.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=ic(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:i}}function ow(n){let e=ew(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){H(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(y){let T=ip(y);return T instanceof Ue&&Lf(T)?T.getFilters():[T]})(t.where));let a=[];t.orderBy&&(a=(function(y){return y.map(T=>(function(N){return new Jt(vn(N.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(N.direction))})(T))})(t.orderBy));let u=null;t.limit&&(u=(function(y){let T;return T=typeof y=="object"?y.value:y,ks(T)?null:T})(t.limit));let h=null;t.startAt&&(h=(function(y){let T=!!y.before,R=y.values||[];return new Qt(R,T)})(t.startAt));let d=null;return t.endAt&&(d=(function(y){let T=!y.before,R=y.values||[];return new Qt(R,T)})(t.endAt)),kI(e,i,a,o,u,"F",h,d)}function aw(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ip(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=vn(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=vn(t.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=vn(t.unaryFilter.field);return ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=vn(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ae.create(vn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ue.create(t.compositeFilter.filters.map(r=>ip(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(t.compositeFilter.op))})(n):L(30097,{filter:n})}function cw(n){return JI[n]}function uw(n){return YI[n]}function lw(n){return XI[n]}function Tn(n){return{fieldPath:n.canonicalString()}}function vn(n){return Ce.fromServerFormat(n.fieldPath)}function sp(n){return n instanceof ae?(function(t){if(t.op==="=="){if(Dd(t.value))return{unaryFilter:{field:Tn(t.field),op:"IS_NAN"}};if(kd(t.value))return{unaryFilter:{field:Tn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Dd(t.value))return{unaryFilter:{field:Tn(t.field),op:"IS_NOT_NAN"}};if(kd(t.value))return{unaryFilter:{field:Tn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Tn(t.field),op:uw(t.op),value:t.value}}})(n):n instanceof Ue?(function(t){let r=t.getFilters().map(i=>sp(i));return r.length===1?r[0]:{compositeFilter:{op:lw(t.op),filters:r}}})(n):L(54877,{filter:n})}function hw(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function op(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function ap(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}var Or=class n{constructor(e,t,r,i,o=U.min(),a=U.min(),u=Ie.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var cc=class{constructor(e){this.yt=e}};function cp(n){let e=ow({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?os(e,e.limit,"L"):e}var ds=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(X(e.integerValue));else if("doubleValue"in e){let r=X(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Pr(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=lt(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ht(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?Vf(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Nf(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):L(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=Pn,o=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(X(o)),this.Ot(i,t),this.Ct(r[i],t)}qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),x.fromName(e).path.forEach(r=>{this.Ft(t,60),this.$t(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};ds.Wt=new ds;var uc=class{constructor(){this.Sn=new lc}addToCollectionParentIndex(e,t){return this.Sn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ht.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ht.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},lc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new pe(ee.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new pe(ee.comparator)).toArray()}};var WA=new Uint8Array(0);var $d={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},up=41943040,Oe=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Oe.DEFAULT_COLLECTION_PERCENTILE=10,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oe.DEFAULT=new Oe(up,Oe.DEFAULT_COLLECTION_PERCENTILE,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oe.DISABLED=new Oe(-1,0,0);var xr=class n{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new n(0)}static ar(){return new n(-1)}};var Gd="LruGarbageCollector",dw=1048576;function Wd([n,e],[t,r]){let i=G(n,t);return i===0?G(e,r):i}var hc=class{constructor(e){this.Pr=e,this.buffer=new pe(Wd),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Wd(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},dc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){k(Gd,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Bn(t)?k(Gd,"Ignoring IndexedDB error during garbage collection: ",t):await qn(t)}await this.Ar(3e5)})}},fc=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(iu.ce);let r=new hc(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.mr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve($d)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$d):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,i,o,a,u,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,a=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,u=Date.now(),this.removeTargets(e,r,t))).next(y=>(o=y,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(d=Date.now(),wn()<=z.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${y} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:y})))}};function fw(n,e){return new fc(n,e)}var pc=class{constructor(){this.changes=new dt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var mc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var gc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Sr(r.mutation,i,We.empty(),ie.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,j()).next(()=>r))}getLocalViewOfDocuments(e,t,r=j()){let i=$t();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=vr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=$t();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,j()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=ft(),a=br(),u=(function(){return br()})();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof pt)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Sr(p.mutation,d,p.mutation.getFieldMask(),ie.now())):a.set(d.key,We.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>u.set(d,new mc(p,a.get(d)??null))),u))}recalculateAndSaveOverlays(e,t){let r=br(),i=new te((a,u)=>a-u),o=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||We.empty();p=u.applyToLocalView(d,p),r.set(h,p);let y=(i.get(u.batchId)||j()).add(h);i=i.insert(u.batchId,y)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),d=h.key,p=h.value,y=Gf();p.forEach(T=>{if(!o.has(T)){let R=Yf(t.get(T),r.get(T));R!==null&&y.set(T,R),o=o.add(T)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,y))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return DI(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):qf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):P.resolve($t()),u=Rr,h=o;return a.next(d=>P.forEach(d,(p,y)=>(u<y.largestBatchId&&(u=y.largestBatchId),o.get(p)?P.resolve():this.remoteDocumentCache.getEntry(e,p).next(T=>{h=h.insert(p,T)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,j())).next(p=>({batchId:u,changes:$f(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(r=>{let i=vr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=vr();return this.indexManager.getCollectionParents(e,o).next(u=>P.forEach(u,h=>{let d=(function(y,T){return new Dn(T,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((y,T)=>{a=a.insert(y,T)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,Fe.newInvalidDocument(p)))});let u=vr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&Sr(p.mutation,d,We.empty(),ie.now()),xs(t,d)&&(u=u.insert(h,d))}),u})}};var _c=class{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return P.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Je(i.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:cp(i.bundledQuery),readTime:Je(i.readTime)}})(t)),P.resolve()}};var yc=class{constructor(){this.overlays=new te(x.comparator),this.Lr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=$t();return P.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.bt(e,t,o)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Lr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Lr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=$t(),o=t.length+1,a=new x(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new te((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=$t(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=$t(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return P.resolve(u)}bt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Za(t,r));let o=this.Lr.get(t);o===void 0&&(o=j(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}};var Ic=class{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var Lr=class{constructor(){this.kr=new pe(oe.Kr),this.qr=new pe(oe.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new oe(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new oe(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){let t=new x(new ee([])),r=new oe(t,e),i=new oe(t,e+1),o=[];return this.qr.forEachInRange([r,i],a=>{this.Wr(a),o.push(a.key)}),o}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new x(new ee([])),r=new oe(t,e),i=new oe(t,e+1),o=j();return this.qr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new oe(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},oe=class{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return x.comparator(e.key,t.key)||G(e.Hr,t.Hr)}static Ur(e,t){return G(e.Hr,t.Hr)||x.comparator(e.key,t.key)}};var wc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new pe(oe.Kr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ya(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Jr=this.Jr.add(new oe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?su:this.Yn-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oe(t,0),i=new oe(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,i],a=>{let u=this.Zr(a.Hr);o.push(u)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new pe(G);return t.forEach(i=>{let o=new oe(i,0),a=new oe(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],u=>{r=r.add(u.Hr)})}),P.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;x.isDocumentKey(o)||(o=o.child(""));let a=new oe(new x(o),0),u=new pe(G);return this.Jr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(h.Hr)),!0)},a),P.resolve(this.Yr(u))}Yr(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){H(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return P.forEach(t.mutations,i=>{let o=new oe(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new oe(t,0),i=this.Jr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Ec=class{constructor(e){this.ti=e,this.docs=(function(){return new te(x.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Fe.newInvalidDocument(t))}getEntries(e,t){let r=ft();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Fe.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=ft(),a=t.path,u=new x(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||hI(lI(p),r)<=0||(i.has(p.key)||xs(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,i){L(9500)}ni(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Tc(this)}getSize(e){return P.resolve(this.size)}},Tc=class extends pc{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}};var vc=class{constructor(e){this.persistence=e,this.ri=new dt(t=>uu(t),lu),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.ii=0,this.si=new Lr,this.targetCount=0,this.oi=xr._r()}forEachTarget(e,t){return this.ri.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),P.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new xr(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.lr(t),P.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.ri.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.si.containsKey(t))}};var fs=class{constructor(e,t){this._i={},this.overlays={},this.ai=new iu(0),this.ui=!1,this.ui=!0,this.ci=new Ic,this.referenceDelegate=e(this),this.li=new vc(this),this.indexManager=new uc,this.remoteDocumentCache=(function(i){return new Ec(i)})(r=>this.referenceDelegate.hi(r)),this.serializer=new cc(t),this.Pi=new _c(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new wc(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){k("MemoryPersistence","Starting transaction:",e);let i=new Ac(this.ai.next());return this.referenceDelegate.Ti(),r(i).next(o=>this.referenceDelegate.Ii(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ei(e,t){return P.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}},Ac=class extends xa{constructor(e){super(),this.currentSequenceNumber=e}},bc=class n{constructor(e){this.persistence=e,this.Ri=new Lr,this.Ai=null}static Vi(e){return new n(e)}get di(){if(this.Ai)return this.Ai;throw L(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(i=>this.di.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.di.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.di,r=>{let i=x.fromPath(r);return this.mi(e,i).next(o=>{o||t.removeEntry(i,U.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},ps=class n{constructor(e,t){this.persistence=e,this.fi=new dt(r=>mI(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=fw(this,t)}static Vi(e,t){return new n(e,t)}Ti(){}Ii(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return P.forEach(this.fi,(r,i)=>this.wr(e,r,i).next(o=>o?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ni(e,a=>this.wr(e,a,t).next(u=>{u||(r++,o.removeEntry(a,U.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wi(e.data.value)),t}wr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.fi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Sc=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=i}static Es(e,t){let r=j(),i=j();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var Rc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Pc=class{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return rh()?8:fI(he())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.gs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ps(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new Rc;return this.ys(e,t,a).next(u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)})}).next(()=>o.result)}ws(e,t,r,i){return r.documentReadCount<this.Vs?(wn()<=z.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",En(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(wn()<=z.DEBUG&&k("QueryEngine","Query:",En(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(wn()<=z.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",En(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qe(t))):P.resolve())}gs(e,t){if(xd(t))return P.resolve(null);let r=Qe(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=os(t,null,"F"),r=Qe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=j(...o);return this.fs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.bs(t,u);return this.Ss(t,d,a,h.readTime)?this.gs(e,os(t,null,"F")):this.Ds(e,d,t,h)}))})))}ps(e,t,r,i){return xd(t)||i.isEqual(U.min())?P.resolve(null):this.fs.getDocuments(e,r).next(o=>{let a=this.bs(t,o);return this.Ss(t,a,r,i)?P.resolve(null):(wn()<=z.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),En(t)),this.Ds(e,a,t,uI(i,Rr)).next(u=>u))})}bs(e,t){let r=new pe(zf(e));return t.forEach((i,o)=>{xs(e,o)&&(r=r.add(o))}),r}Ss(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ys(e,t,r){return wn()<=z.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",En(t)),this.fs.getDocumentsMatchingQuery(e,t,Ht.min(),r)}Ds(e,t,r,i){return this.fs.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var fu="LocalStore",pw=3e8,Cc=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new te(G),this.Fs=new dt(o=>uu(o),lu),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gc(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}};function mw(n,e,t,r){return new Cc(n,e,t,r)}async function lp(n,e){let t=F(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=j();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({Ns:d,removedBatchIds:a,addedBatchIds:u}))})})}function gw(n,e){let t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){let y=d.batch,T=y.keys(),R=P.resolve();return T.forEach(N=>{R=R.next(()=>p.getEntry(h,N)).next(O=>{let D=d.docVersions.get(N);H(D!==null,48541),O.version.compareTo(D)<0&&(y.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),p.addEntry(O)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(h,y))})(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=j();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function hp(n){let e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function _w(n,e){let t=F(n),r=e.snapshotVersion,i=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.xs.newChangeBuffer({trackRemovals:!0});i=t.vs;let u=[];e.targetChanges.forEach((p,y)=>{let T=i.get(y);if(!T)return;u.push(t.li.removeMatchingKeys(o,p.removedDocuments,y).next(()=>t.li.addMatchingKeys(o,p.addedDocuments,y)));let R=T.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?R=R.withResumeToken(Ie.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(y,R),(function(O,D,$){return O.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=pw?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0})(T,R,p)&&u.push(t.li.updateTargetData(o,R))});let h=ft(),d=j();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(yw(o,a,e.documentUpdates).next(p=>{h=p.Bs,d=p.Ls})),!r.isEqual(U.min())){let p=t.li.getLastRemoteSnapshotVersion(o).next(y=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return P.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.vs=i,o))}function yw(n,e,t){let r=j(),i=j();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=ft();return t.forEach((u,h)=>{let d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(U.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):k(fu,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)}),{Bs:a,Ls:i}})}function Iw(n,e){let t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=su),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ww(n,e){let t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.li.getTargetData(r,e).next(o=>o?(i=o,P.resolve(i)):t.li.allocateTargetId(r).next(a=>(i=new Or(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.vs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}async function kc(n,e,t){let r=F(n),i=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Bn(a))throw a;k(fu,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(i.target)}function Kd(n,e,t){let r=F(n),i=U.min(),o=j();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(h,d,p){let y=F(h),T=y.Fs.get(p);return T!==void 0?P.resolve(y.vs.get(T)):y.li.getTargetData(d,p)})(r,a,Qe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:U.min(),t?o:j())).next(u=>(Ew(r,VI(e),u),{documents:u,ks:o})))}function Ew(n,e,t){let r=n.Ms.get(e)||U.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ms.set(e,r)}var ms=class{constructor(){this.activeTargetIds=UI()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Dc=class{constructor(){this.vo=new ms,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new ms,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Nc=class{Mo(e){}shutdown(){}};var Hd="ConnectivityMonitor",gs=class{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){k(Hd,"Network connectivity changed: AVAILABLE");for(let e of this.Lo)e(0)}Bo(){k(Hd,"Network connectivity changed: UNAVAILABLE");for(let e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Gi=null;function Vc(){return Gi===null?Gi=(function(){return 268435456+Math.round(2147483648*Math.random())})():Gi++,"0x"+Gi.toString(16)}var Pa="RestConnection",Tw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"},Oc=class{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===is?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,o){let a=Vc(),u=this.Qo(e,t.toUriEncodedString());k(Pa,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,i,o);let{host:d}=new URL(u),p=Tt(d);return this.zo(e,u,h,r,p).then(y=>(k(Pa,`Received RPC '${e}' ${a}: `,y),y),y=>{throw ut(Pa,`RPC '${e}' ${a} failed with error: `,y,"url: ",u,"request:",r),y})}jo(e,t,r,i,o,a){return this.Wo(e,t,r,i,o)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Fn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}Qo(e,t){let r=Tw[e],i=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}};var xc=class{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}};var Te="WebChannelConnection",Tr=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(i){setTimeout(()=>{throw i},0)}})},_s=class n extends Oc{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!n.c_){let e=Aa();Tr(e,va.STAT_EVENT,t=>{t.stat===zi.PROXY?k(Te,"STAT_EVENT: detected buffering proxy"):t.stat===zi.NOPROXY&&k(Te,"STAT_EVENT: detected no buffering proxy")}),n.c_=!0}}zo(e,t,r,i,o){let a=Vc();return new Promise((u,h)=>{let d=new Ea;d.setWithCredentials(!0),d.listenOnce(Ta.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Er.NO_ERROR:let y=d.getResponseJson();k(Te,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),u(y);break;case Er.TIMEOUT:k(Te,`RPC '${e}' ${a} timed out`),h(new V(S.DEADLINE_EXCEEDED,"Request time out"));break;case Er.HTTP_ERROR:let T=d.getStatus();if(k(Te,`RPC '${e}' ${a} failed with status:`,T,"response text:",d.getResponseText()),T>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let N=R?.error;if(N&&N.status&&N.message){let O=(function($){let K=$.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(K)>=0?K:S.UNKNOWN})(N.status);h(new V(O,N.message))}else h(new V(S.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new V(S.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{k(Te,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);k(Te,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}T_(e,t,r){let i=Vc(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let d=o.join("");k(Te,`Creating RPC '${e}' stream ${i}: ${d}`,u);let p=a.createWebChannel(d,u);this.I_(p);let y=!1,T=!1,R=new xc({Ho:N=>{T?k(Te,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(y||(k(Te,`Opening RPC '${e}' stream ${i} transport.`),p.open(),y=!0),k(Te,`RPC '${e}' stream ${i} sending:`,N),p.send(N))},Jo:()=>p.close()});return Tr(p,In.EventType.OPEN,()=>{T||(k(Te,`RPC '${e}' stream ${i} transport opened.`),R.i_())}),Tr(p,In.EventType.CLOSE,()=>{T||(T=!0,k(Te,`RPC '${e}' stream ${i} transport closed`),R.o_(),this.E_(p))}),Tr(p,In.EventType.ERROR,N=>{T||(T=!0,ut(Te,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),R.o_(new V(S.UNAVAILABLE,"The operation could not be completed")))}),Tr(p,In.EventType.MESSAGE,N=>{if(!T){let O=N.data[0];H(!!O,16349);let D=O,$=D?.error||D[0]?.error;if($){k(Te,`RPC '${e}' stream ${i} received error:`,$);let K=$.status,J=(function(me){let w=se[me];if(w!==void 0)return Zf(w)})(K),we=$.message;K==="NOT_FOUND"&&we.includes("database")&&we.includes("does not exist")&&we.includes(this.databaseId.database)&&ut(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),J===void 0&&(J=S.INTERNAL,we="Unknown error status: "+K+" with message "+$.message),T=!0,R.o_(new V(J,we)),p.close()}else k(Te,`RPC '${e}' stream ${i} received:`,O),R.__(O)}}),n.u_(),setTimeout(()=>{R.s_()},0),R}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return ba()}};function vw(n){return new _s(n)}function Ca(){return typeof document<"u"?document:null}function zr(n){return new rc(n,!0)}_s.c_=!1;var ys=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=i,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}};var Qd="PersistentStream",Is=class{constructor(e,t,r,i,o,a,u,h){this.Ci=e,this.b_=r,this.S_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ys(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ct(t.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new V(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.H_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return k(Qd,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(k(Qd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Lc=class extends Is{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=tw(this.serializer,e),r=(function(o){if(!("targetChange"in o))return U.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?Je(a.readTime):U.min()})(e);return this.listener.J_(t,r)}Z_(e){let t={};t.database=ac(this.serializer),t.addTarget=(function(o,a){let u,h=a.target;if(u=Ha(h)?{documents:iw(o,h)}:{query:sw(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=ep(o,a.resumeToken);let d=ic(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=hs(o,a.snapshotVersion.toTimestamp());let d=ic(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);let r=aw(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){let t={};t.database=ac(this.serializer),t.removeTarget=e,this.K_(t)}},Mc=class extends Is{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return H(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,H(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){H(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=rw(e.writeResults,e.commitTime),r=Je(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=ac(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>nw(this.serializer,r))};this.K_(t)}};var Fc=class{},Uc=class extends Fc{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Wo(e,sc(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(S.UNKNOWN,o.toString())})}jo(e,t,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.jo(e,sc(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(S.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}};function Aw(n,e,t,r){return new Uc(n,e,t,r)}var qc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ct(t),this.aa=!1):k("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var en="RemoteStore",Bc=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo(a=>{r.enqueueAndForget(async()=>{on(this)&&(k(en,"Restarting streams for network reachability change."),await(async function(h){let d=F(h);d.Ea.add(4),await jr(d),d.Va.set("Unknown"),d.Ea.delete(4),await Ls(d)})(this))})}),this.Va=new qc(r,i)}};async function Ls(n){if(on(n))for(let e of n.Ra)await e(!0)}async function jr(n){for(let e of n.Ra)await e(!1)}function dp(n,e){let t=F(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),_u(t)?gu(t):zn(t).O_()&&mu(t,e))}function pu(n,e){let t=F(n),r=zn(t);t.Ia.delete(e),r.O_()&&fp(t,e),t.Ia.size===0&&(r.O_()?r.L_():on(t)&&t.Va.set("Unknown"))}function mu(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zn(n).Z_(e)}function fp(n,e){n.da.$e(e),zn(n).X_(e)}function gu(n){n.da=new nc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),zn(n).start(),n.Va.ua()}function _u(n){return on(n)&&!zn(n).x_()&&n.Ia.size>0}function on(n){return F(n).Ea.size===0}function pp(n){n.da=void 0}async function bw(n){n.Va.set("Online")}async function Sw(n){n.Ia.forEach((e,t)=>{mu(n,e)})}async function Rw(n,e){pp(n),_u(n)?(n.Va.ha(e),gu(n)):n.Va.set("Unknown")}async function Pw(n,e,t){if(n.Va.set("Online"),e instanceof us&&e.state===2&&e.cause)try{await(async function(i,o){let a=o.cause;for(let u of o.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,a),i.Ia.delete(u),i.da.removeTarget(u))})(n,e)}catch(r){k(en,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ws(n,r)}else if(e instanceof Sn?n.da.Xe(e):e instanceof cs?n.da.st(e):n.da.tt(e),!t.isEqual(U.min()))try{let r=await hp(n.localStore);t.compareTo(r)>=0&&await(function(o,a){let u=o.da.Tt(a);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,d)=>{let p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Ie.EMPTY_BYTE_STRING,p.snapshotVersion)),fp(o,h);let y=new Or(p.target,h,d,p.sequenceNumber);mu(o,y)}),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){k(en,"Failed to raise snapshot:",r),await ws(n,r)}}async function ws(n,e,t){if(!Bn(e))throw e;n.Ea.add(1),await jr(n),n.Va.set("Offline"),t||(t=()=>hp(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{k(en,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ls(n)})}function mp(n,e){return e().catch(t=>ws(n,t,e))}async function Ms(n){let e=F(n),t=Dt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:su;for(;Cw(e);)try{let i=await Iw(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,kw(e,i)}catch(i){await ws(e,i)}gp(e)&&_p(e)}function Cw(n){return on(n)&&n.Ta.length<10}function kw(n,e){n.Ta.push(e);let t=Dt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function gp(n){return on(n)&&!Dt(n).x_()&&n.Ta.length>0}function _p(n){Dt(n).start()}async function Dw(n){Dt(n).ra()}async function Nw(n){let e=Dt(n);for(let t of n.Ta)e.ea(t.mutations)}async function Vw(n,e,t){let r=n.Ta.shift(),i=Xa.from(r,e,t);await mp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await Ms(n)}async function Ow(n,e){e&&Dt(n).Y_&&await(async function(r,i){if((function(a){return WI(a)&&a!==S.ABORTED})(i.code)){let o=r.Ta.shift();Dt(r).B_(),await mp(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await Ms(r)}})(n,e),gp(n)&&_p(n)}async function Jd(n,e){let t=F(n);t.asyncQueue.verifyOperationInProgress(),k(en,"RemoteStore received new credentials");let r=on(t);t.Ea.add(3),await jr(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ls(t)}async function xw(n,e){let t=F(n);e?(t.Ea.delete(2),await Ls(t)):e||(t.Ea.add(2),await jr(t),t.Va.set("Unknown"))}function zn(n){return n.ma||(n.ma=(function(t,r,i){let o=F(t);return o.sa(),new Lc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:bw.bind(null,n),Yo:Sw.bind(null,n),t_:Rw.bind(null,n),J_:Pw.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),_u(n)?gu(n):n.Va.set("Unknown")):(await n.ma.stop(),pp(n))})),n.ma}function Dt(n){return n.fa||(n.fa=(function(t,r,i){let o=F(t);return o.sa(),new Mc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:Dw.bind(null,n),t_:Ow.bind(null,n),ta:Nw.bind(null,n),na:Vw.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await Ms(n)):(await n.fa.stop(),n.Ta.length>0&&(k(en,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}var zc=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Ke,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function yu(n,e){if(ct("AsyncQueue",`${e}: ${n}`),Bn(n))return new V(S.UNAVAILABLE,`${e}: ${n}`);throw n}var Mr=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||x.comparator(t.key,r.key):(t,r)=>x.comparator(t.key,r.key),this.keyedMap=vr(),this.sortedSet=new te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Es=class{constructor(){this.ga=new te(x.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):L(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},tn=class n{constructor(e,t,r,i,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,Mr.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Os(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var jc=class{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}},$c=class{constructor(){this.queries=Yd(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=F(t),o=i.queries;i.queries=Yd(),o.forEach((a,u)=>{for(let h of u.ba)h.onError(r)})})(this,new V(S.ABORTED,"Firestore shutting down"))}};function Yd(){return new dt(n=>Bf(n),Os)}async function Lw(n,e){let t=F(n),r=3,i=e.query,o=t.queries.get(i);o?!o.Sa()&&e.Da()&&(r=2):(o=new jc,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(i,!0);break;case 1:o.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){let u=yu(a,`Initialization of query '${En(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Iu(t)}async function Mw(n,e){let t=F(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?i=e.Da()?0:1:!o.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Fw(n,e){let t=F(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.ba)u.Fa(i)&&(r=!0);a.wa=i}}r&&Iu(t)}function Uw(n,e,t){let r=F(n),i=r.queries.get(e);if(i)for(let o of i.ba)o.onError(t);r.queries.delete(e)}function Iu(n){n.Ca.forEach(e=>{e.next()})}var Gc,Xd;(Xd=Gc||(Gc={})).Ma="default",Xd.Cache="cache";var Wc=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Gc.Cache}};var Ts=class{constructor(e){this.key=e}},vs=class{constructor(e){this.key=e}},Kc=class{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=j(),this.mutatedKeys=j(),this.eu=zf(e),this.tu=new Mr(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new Es,i=t?t.tu:this.tu,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,y)=>{let T=i.get(p),R=xs(this.query,y)?y:null,N=!!T&&this.mutatedKeys.has(T.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;T&&R?T.data.isEqual(R.data)?N!==O&&(r.track({type:3,doc:R}),D=!0):this.su(T,R)||(r.track({type:2,doc:R}),D=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!T&&R?(r.track({type:0,doc:R}),D=!0):T&&!R&&(r.track({type:1,doc:T}),D=!0,(h||d)&&(u=!0)),D&&(R?(a=a.add(R),o=O?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((p,y)=>(function(R,N){let O=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Vt:D})}};return O(R)-O(N)})(p.type,y.type)||this.eu(p.doc,y.doc)),this.ou(r),i=i??!1;let u=t&&!i?this._u():[],h=this.Ya.size===0&&this.current&&!i?1:0,d=h!==this.Xa;return this.Xa=h,a.length!==0||d?{snapshot:new tn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Es,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=j(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});let t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new vs(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Ts(r))}),t}cu(e){this.Za=e.ks,this.Ya=j();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return tn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}},wu="SyncEngine",Hc=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Qc=class{constructor(e){this.key=e,this.hu=!1}},Jc=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new dt(u=>Bf(u),Os),this.Iu=new Map,this.Eu=new Set,this.Ru=new te(x.comparator),this.Au=new Map,this.Vu=new Lr,this.du={},this.mu=new Map,this.fu=xr.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};async function qw(n,e,t=!0){let r=vp(n),i,o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await yp(r,e,t,!0),i}async function Bw(n,e){let t=vp(n);await yp(t,e,!0,!1)}async function yp(n,e,t,r){let i=await ww(n.localStore,Qe(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=await zw(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&dp(n.remoteStore,i),u}async function zw(n,e,t,r,i){n.pu=(y,T,R)=>(async function(O,D,$,K){let J=D.view.ru($);J.Ss&&(J=await Kd(O.localStore,D.query,!1).then(({documents:w})=>D.view.ru(w,J)));let we=K&&K.targetChanges.get(D.targetId),Le=K&&K.targetMismatches.get(D.targetId)!=null,me=D.view.applyChanges(J,O.isPrimaryClient,we,Le);return ef(O,D.targetId,me.au),me.snapshot})(n,y,T,R);let o=await Kd(n.localStore,e,!0),a=new Kc(e,o.ks),u=a.ru(o.documents),h=Vr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,h);ef(n,t,d.au);let p=new Hc(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function jw(n,e,t){let r=F(n),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter(a=>!Os(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await kc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&pu(r.remoteStore,i.targetId),Yc(r,i.targetId)}).catch(qn)):(Yc(r,i.targetId),await kc(r.localStore,i.targetId,!0))}async function $w(n,e){let t=F(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),pu(t.remoteStore,r.targetId))}async function Gw(n,e,t){let r=Xw(n);try{let i=await(function(a,u){let h=F(a),d=ie.now(),p=u.reduce((R,N)=>R.add(N.key),j()),y,T;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let N=ft(),O=j();return h.xs.getEntries(R,p).next(D=>{N=D,N.forEach(($,K)=>{K.isValidDocument()||(O=O.add($))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,N)).next(D=>{y=D;let $=[];for(let K of u){let J=GI(K,y.get(K.key).overlayedDocument);J!=null&&$.push(new pt(K.key,J,Of(J.value.mapValue),Ct.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,$,u)}).next(D=>{T=D;let $=D.applyToLocalDocumentSet(y,O);return h.documentOverlayCache.saveOverlays(R,D.batchId,$)})}).then(()=>({batchId:T.batchId,changes:$f(y)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,u,h){let d=a.du[a.currentUser.toKey()];d||(d=new te(G)),d=d.insert(u,h),a.du[a.currentUser.toKey()]=d})(r,i.batchId,t),await $r(r,i.changes),await Ms(r.remoteStore)}catch(i){let o=yu(i,"Failed to persist write");t.reject(o)}}async function Ip(n,e){let t=F(n);try{let r=await _w(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Au.get(o);a&&(H(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?H(a.hu,14607):i.removedDocuments.size>0&&(H(a.hu,42227),a.hu=!1))}),await $r(t,r,e)}catch(r){await qn(r)}}function Zd(n,e,t){let r=F(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((o,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(a,u){let h=F(a);h.onlineState=u;let d=!1;h.queries.forEach((p,y)=>{for(let T of y.ba)T.va(u)&&(d=!0)}),d&&Iu(h)})(r.eventManager,e),i.length&&r.Pu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Ww(n,e,t){let r=F(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),o=i&&i.key;if(o){let a=new te(x.comparator);a=a.insert(o,Fe.newNoDocument(o,U.min()));let u=j().add(o),h=new as(U.min(),new Map,new te(G),a,u);await Ip(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),Eu(r)}else await kc(r.localStore,e,!1).then(()=>Yc(r,e,t)).catch(qn)}async function Kw(n,e){let t=F(n),r=e.batch.batchId;try{let i=await gw(t.localStore,e);Ep(t,r,null),wp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await $r(t,i)}catch(i){await qn(i)}}async function Hw(n,e,t){let r=F(n);try{let i=await(function(a,u){let h=F(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(y=>(H(y!==null,37113),p=y.keys(),h.mutationQueue.removeMutationBatch(d,y))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})})(r.localStore,e);Ep(r,e,t),wp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await $r(r,i)}catch(i){await qn(i)}}function wp(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Ep(n,e,t){let r=F(n),i=r.du[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.du[r.currentUser.toKey()]=i}}function Yc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||Tp(n,r)})}function Tp(n,e){n.Eu.delete(e.path.canonicalString());let t=n.Ru.get(e);t!==null&&(pu(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),Eu(n))}function ef(n,e,t){for(let r of t)r instanceof Ts?(n.Vu.addReference(r.key,e),Qw(n,r)):r instanceof vs?(k(wu,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Tp(n,r.key)):L(19791,{wu:r})}function Qw(n,e){let t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(k(wu,"New document in limbo: "+t),n.Eu.add(r),Eu(n))}function Eu(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new x(ee.fromString(e)),r=n.fu.next();n.Au.set(r,new Qc(t)),n.Ru=n.Ru.insert(t,r),dp(n.remoteStore,new Or(Qe(Vs(t.path)),r,"TargetPurposeLimboResolution",iu.ce))}}async function $r(n,e,t){let r=F(n),i=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{a.push(r.pu(h,e,t).then(d=>{if((d||t)&&r.isPrimaryClient){let p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){i.push(d);let p=Sc.Es(h.targetId,d);o.push(p)}}))}),await Promise.all(a),r.Pu.J_(i),await(async function(h,d){let p=F(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>P.forEach(d,T=>P.forEach(T.Ts,R=>p.persistence.referenceDelegate.addReference(y,T.targetId,R)).next(()=>P.forEach(T.Is,R=>p.persistence.referenceDelegate.removeReference(y,T.targetId,R)))))}catch(y){if(!Bn(y))throw y;k(fu,"Failed to update sequence numbers: "+y)}for(let y of d){let T=y.targetId;if(!y.fromCache){let R=p.vs.get(T),N=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(N);p.vs=p.vs.insert(T,O)}}})(r.localStore,o))}async function Jw(n,e){let t=F(n);if(!t.currentUser.isEqual(e)){k(wu,"User change. New user:",e.toKey());let r=await lp(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new V(S.CANCELLED,a))})}),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await $r(t,r.Ns)}}function Yw(n,e){let t=F(n),r=t.Au.get(e);if(r&&r.hu)return j().add(r.key);{let i=j(),o=t.Iu.get(e);if(!o)return i;for(let a of o){let u=t.Tu.get(a);i=i.unionWith(u.view.nu)}return i}}function vp(n){let e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ip.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ww.bind(null,e),e.Pu.J_=Fw.bind(null,e.eventManager),e.Pu.yu=Uw.bind(null,e.eventManager),e}function Xw(n){let e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Kw.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Hw.bind(null,e),e}var Tu=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=zr(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,r){return null}Mu(t,r){return null}vu(t){return mw(this.persistence,new Pc,t.initialUser,this.serializer)}Cu(t){return new fs(bc.Vi,this.serializer)}Du(t){return new Dc}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})(),As=class extends Tu{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){H(this.persistence.referenceDelegate instanceof ps,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new dc(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?Oe.withCacheSize(this.cacheSizeBytes):Oe.DEFAULT;return new fs(r=>ps.Vi(r,t),this.serializer)}};var Ap=(()=>{class n{async initialize(t,r){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Zd(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jw.bind(null,this.syncEngine),await xw(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new $c})()}createDatastore(t){let r=zr(t.databaseInfo.databaseId),i=vw(t.databaseInfo);return Aw(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,o,a,u,h){return new Bc(i,o,a,u,h)})(this.localStore,this.datastore,t.asyncQueue,r=>Zd(this.syncEngine,r,0),(function(){return gs.v()?new gs:new Nc})())}createSyncEngine(t,r){return(function(o,a,u,h,d,p,y){let T=new Jc(o,a,u,h,d,p);return y&&(T.gu=!0),T})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}async terminate(){await(async function(r){let i=F(r);k(en,"RemoteStore shutting down."),i.Ea.add(5),await jr(i),i.Aa.shutdown(),i.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}return n.provider={build:()=>new n},n})();var Xc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ct("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Nt="FirestoreClient",Zc=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=i,this.user=fe.UNAUTHENTICATED,this.clientId=Kt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{k(Nt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(k(Nt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ke;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=yu(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}};async function ka(n,e){n.asyncQueue.verifyOperationInProgress(),k(Nt,"Initializing OfflineComponentProvider");let t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await lp(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function tf(n,e){n.asyncQueue.verifyOperationInProgress();let t=await Zw(n);k(Nt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Jd(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Jd(e.remoteStore,i)),n._onlineComponents=e}async function Zw(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k(Nt,"Using user provided OfflineComponentProvider");try{await ka(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===S.FAILED_PRECONDITION||i.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;ut("Error using user provided cache. Falling back to memory cache: "+t),await ka(n,new Tu)}}else k(Nt,"Using default OfflineComponentProvider"),await ka(n,new As(void 0));return n._offlineComponents}async function bp(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(k(Nt,"Using user provided OnlineComponentProvider"),await tf(n,n._uninitializedComponentsProvider._online)):(k(Nt,"Using default OnlineComponentProvider"),await tf(n,new Ap))),n._onlineComponents}function eE(n){return bp(n).then(e=>e.syncEngine)}async function tE(n){let e=await bp(n),t=e.eventManager;return t.onListen=qw.bind(null,e.syncEngine),t.onUnlisten=jw.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Bw.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=$w.bind(null,e.syncEngine),t}function Sp(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(async()=>(function(o,a,u,h,d){let p=new Xc({next:T=>{p.Nu(),a.enqueueAndForget(()=>Mw(o,y));let R=T.docs.has(u);!R&&T.fromCache?d.reject(new V(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&T.fromCache&&h&&h.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(T)},error:T=>d.reject(T)}),y=new Wc(Vs(u.path),p,{includeMetadataChanges:!0,Ka:!0});return Lw(o,y)})(await tE(n),n.asyncQueue,e,t,r)),r.promise}function Rp(n,e){let t=new Ke;return n.asyncQueue.enqueueAndForget(async()=>Gw(await eE(n),e,t)),t.promise}function Pp(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var nE="ComponentProvider",nf=new Map;function rE(n,e,t,r,i){return new La(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Pp(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}var Cp="firestore.googleapis.com",rf=!0,bs=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Cp,this.ssl=rf}else this.host=e.host,this.ssl=e.ssl??rf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=up;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<dw)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}uf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Pp(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Fr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bs({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bs(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Ji;switch(r.type){case"firstParty":return new Va(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=nf.get(t);r&&(k(nE,"Removing Datastore"),nf.delete(t),r.terminate())})(this),Promise.resolve()}};function kp(n,e,t,r={}){n=rn(n,Fr);let i=Tt(e),o=n._getSettings(),a=le(B({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;i&&(fi(`https://${u}`),pi("Firestore",!0)),o.host!==Cp&&o.host!==u&&ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=le(B({},o),{host:u,ssl:i,emulatorOptions:r});if(!Ne(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=fe.MOCK_USER;else{d=Xl(r.mockUserToken,n._app?.options.projectId);let y=r.mockUserToken.sub||r.mockUserToken.user_id;if(!y)throw new V(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new fe(y)}n._authCredentials=new Da(new Qi(d,p))}}var Ur=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ye=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ln(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Un(t,n._jsonSchema))return new n(e,r||null,new x(ee.fromString(t.referencePath)))}};ye._jsonSchemaVersion="firestore/documentReference/1.0",ye._jsonSchema={type:re("string",ye._jsonSchemaVersion),referencePath:re("string")};var Ln=class n extends Ur{constructor(e,t,r){super(e,t,Vs(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ye(this.firestore,null,new x(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Gr(n,e,...t){if(n=ne(n),arguments.length===1&&(e=Kt.newId()),cI("doc","path",e),n instanceof Fr){let r=ee.fromString(e,...t);return vd(r),new ye(n,null,new x(r))}{if(!(n instanceof ye||n instanceof Ln))throw new V(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ee.fromString(e,...t));return vd(r),new ye(n.firestore,n instanceof Ln?n.converter:null,new x(r))}}var sf="AsyncQueue",Ss=class{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ys(this,"async_queue_retry"),this._c=()=>{let r=Ca();r&&k(sf,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=Ca();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=Ca();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new Ke;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Bn(e))throw e;k(sf,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,ct("INTERNAL UNHANDLED ERROR: ",of(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=zc.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(i),i}uc(){this.nc&&L(47125,{Pc:of(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function of(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var nn=class extends Fr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Ss,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Ss(e),this._firestoreClient=void 0,await e}}};function vu(n,e){let t=typeof n=="object"?n:Ut(),r=typeof n=="string"?n:e||is,i=Me(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=Yl("firestore");o&&kp(i,...o)}return i}function Fs(n){if(n._terminated)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||iE(n),n._firestoreClient}function iE(n){let e=n._freezeSettings(),t=rE(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Zc(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){let o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(n._componentsProvider))}var Ye=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ie.fromBase64String(e))}catch(t){throw new V(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Un(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Ye._jsonSchemaVersion="firestore/bytes/1.0",Ye._jsonSchema={type:re("string",Ye._jsonSchemaVersion),bytes:re("string")};var Mn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var qr=class{constructor(e){this._methodName=e}};var at=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Un(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};at._jsonSchemaVersion="firestore/geoPoint/1.0",at._jsonSchema={type:re("string",at._jsonSchemaVersion),latitude:re("number"),longitude:re("number")};var Xe=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Un(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new V(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Xe._jsonSchemaVersion="firestore/vectorValue/1.0",Xe._jsonSchema={type:re("string",Xe._jsonSchemaVersion),vectorValues:re("object")};var sE=/^__.*__$/,eu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new pt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Zt(e,this.data,t,this.fieldTransforms)}};function Dp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{dataSource:n})}}var tu=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(B(B({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Rs(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Dp(this.dataSource)&&sE.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},nu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||zr(e)}createContext(e,t,r,i=!1){return new tu({dataSource:e,methodName:t,targetDoc:r,path:Ce.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Np(n){let e=n._freezeSettings(),t=zr(n._databaseId);return new nu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Vp(n,e,t,r,i,o={}){let a=n.createContext(o.merge||o.mergeFields?2:0,e,t,i);Mp("Data must be an object, but it was:",a,r);let u=xp(r,a),h,d;if(o.merge)h=new We(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let y of o.mergeFields){let T=Us(e,y,t);if(!a.contains(T))throw new V(S.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);aE(p,T)||p.push(T)}h=new We(p),d=a.fieldTransforms.filter(y=>h.covers(y.field))}else h=null,d=a.fieldTransforms;return new eu(new xe(u),h,d)}function Op(n,e){if(Lp(n=ne(n)))return Mp("Unsupported field value:",e,n),xp(n,e);if(n instanceof qr)return(function(r,i){if(!Dp(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,i){let o=[],a=0;for(let u of r){let h=Op(u,i.childContextForArray(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return qI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=ie.fromDate(r);return{timestampValue:hs(i.serializer,o)}}if(r instanceof ie){let o=new ie(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:hs(i.serializer,o)}}if(r instanceof at)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ye)return{bytesValue:ep(i.serializer,r._byteString)};if(r instanceof ye){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:du(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Xe)return(function(a,u){let h=a instanceof Xe?a.toArray():a;return{mapValue:{fields:{[ou]:{stringValue:au},[Pn]:{arrayValue:{values:h.map(p=>{if(typeof p!="number")throw u.createError("VectorValues must only contain numeric values.");return hu(u.serializer,p)})}}}}}})(r,i);if(ap(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${Cs(r)}`)})(n,e)}function xp(n,e){let t={};return bf(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):sn(n,(r,i)=>{let o=Op(i,e.childContextForField(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Lp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ie||n instanceof at||n instanceof Ye||n instanceof ye||n instanceof qr||n instanceof Xe||ap(n))}function Mp(n,e,t){if(!Lp(t)||!lf(t)){let r=Cs(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Us(n,e,t){if((e=ne(e))instanceof Mn)return e._internalPath;if(typeof e=="string")return Fp(n,e);throw Rs("Field path arguments must be of type string or ",n,!1,void 0,t)}var oE=new RegExp("[~\\*/\\[\\]]");function Fp(n,e,t){if(e.search(oE)>=0)throw Rs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Mn(...e.split("."))._internalPath}catch{throw Rs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rs(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new V(S.INVALID_ARGUMENT,u+n+h)}function aE(n,e){return n.some(t=>t.isEqual(e))}var Br=class{convertValue(e,t="none"){switch(kt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return X(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ht(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return sn(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){let t=e.fields?.[Pn].arrayValue?.values?.map(r=>X(r.doubleValue));return new Xe(t)}convertGeoPoint(e){return new at(X(e.latitude),X(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ns(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Cr(e));default:return null}}convertTimestamp(e){let t=lt(e);return new ie(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ee.fromString(e);H(op(r),9688,{name:e});let i=new kr(r.get(1),r.get(3)),o=new x(r.popFirst(5));return i.isEqual(t)||ct(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};var Ps=class extends Br{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ye(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};var Up="@firebase/firestore",qp="4.11.0";var qs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ye(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Au(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(Us("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Au=class extends qs{data(){return super.data()}};function hE(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var an=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},cn=class n extends qs{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new jn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Us("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};cn._jsonSchemaVersion="firestore/documentSnapshot/1.0",cn._jsonSchema={type:re("string",cn._jsonSchemaVersion),bundleSource:re("string","DocumentSnapshot"),bundleName:re("string"),bundle:re("string")};var jn=class extends cn{data(e={}){return super.data(e)}},Wr=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new an(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new jn(this._firestore,this._userDataWriter,r.key,r,new an(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new jn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new jn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:dE(u.type),doc:h,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Kt.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function dE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}Wr._jsonSchemaVersion="firestore/querySnapshot/1.0",Wr._jsonSchema={type:re("string",Wr._jsonSchemaVersion),bundleSource:re("string","QuerySnapshot"),bundleName:re("string"),bundle:re("string")};function Bp(n){n=rn(n,ye);let e=rn(n.firestore,nn),t=Fs(e);return Sp(t,n._key).then(r=>pE(e,n,r))}function zp(n,e,t){n=rn(n,ye);let r=rn(n.firestore,nn),i=hE(n.converter,e,t),o=Np(r);return fE(r,[Vp(o,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ct.none())])}function fE(n,e){let t=Fs(n);return Rp(t,e)}function pE(n,e,t){let r=t.docs.get(e._key),i=new Ps(n);return new cn(n,i,e._key,r,new an(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){af(At),Re(new de("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new nn(new Yi(r.getProvider("auth-internal")),new Zi(a,r.getProvider("app-check-internal")),kf(a,i),a);return o=B({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),_e(Up,qp,e),_e(Up,qp,"esm2020")})();var mE="firebase",gE="12.9.0";_e(mE,gE,"app");var Gp="@firebase/installations",Pu="0.6.19";var Wp=1e4,Kp=`w:${Pu}`,Hp="FIS_v2",_E="https://firebaseinstallations.googleapis.com/v1",yE=3600*1e3,IE="installations",wE="Installations";var EE={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},ln=new De(IE,wE,EE);function Qp(n){return n instanceof ge&&n.code.includes("request-failed")}function Jp({projectId:n}){return`${_E}/projects/${n}/installations`}function Yp(n){return{token:n.token,requestStatus:2,expiresIn:vE(n.expiresIn),creationTime:Date.now()}}async function Xp(n,e){let r=(await e.json()).error;return ln.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function Zp({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function TE(n,{refreshToken:e}){let t=Zp(n);return t.append("Authorization",AE(e)),t}async function em(n){let e=await n();return e.status>=500&&e.status<600?n():e}function vE(n){return Number(n.replace("s","000"))}function AE(n){return`${Hp} ${n}`}async function bE({appConfig:n,heartbeatServiceProvider:e},{fid:t}){let r=Jp(n),i=Zp(n),o=e.getImmediate({optional:!0});if(o){let d=await o.getHeartbeatsHeader();d&&i.append("x-firebase-client",d)}let a={fid:t,authVersion:Hp,appId:n.appId,sdkVersion:Kp},u={method:"POST",headers:i,body:JSON.stringify(a)},h=await em(()=>fetch(r,u));if(h.ok){let d=await h.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:Yp(d.authToken)}}else throw await Xp("Create Installation",h)}function tm(n){return new Promise(e=>{setTimeout(e,n)})}function SE(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}var RE=/^[cdef][\w-]{21}$/,Ru="";function PE(){try{let n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;let t=CE(n);return RE.test(t)?t:Ru}catch{return Ru}}function CE(n){return SE(n).substr(0,22)}function zs(n){return`${n.appName}!${n.appId}`}var nm=new Map;function rm(n,e){let t=zs(n);im(t,e),kE(t,e)}function im(n,e){let t=nm.get(n);if(t)for(let r of t)r(e)}function kE(n,e){let t=DE();t&&t.postMessage({key:n,fid:e}),NE()}var un=null;function DE(){return!un&&"BroadcastChannel"in self&&(un=new BroadcastChannel("[Firebase] FID Change"),un.onmessage=n=>{im(n.data.key,n.data.fid)}),un}function NE(){nm.size===0&&un&&(un.close(),un=null)}var VE="firebase-installations-database",OE=1,hn="firebase-installations-store",bu=null;function Cu(){return bu||(bu=Ii(VE,OE,{upgrade:(n,e)=>{e===0&&n.createObjectStore(hn)}})),bu}async function Bs(n,e){let t=zs(n),i=(await Cu()).transaction(hn,"readwrite"),o=i.objectStore(hn),a=await o.get(t);return await o.put(e,t),await i.done,(!a||a.fid!==e.fid)&&rm(n,e.fid),e}async function sm(n){let e=zs(n),r=(await Cu()).transaction(hn,"readwrite");await r.objectStore(hn).delete(e),await r.done}async function js(n,e){let t=zs(n),i=(await Cu()).transaction(hn,"readwrite"),o=i.objectStore(hn),a=await o.get(t),u=e(a);return u===void 0?await o.delete(t):await o.put(u,t),await i.done,u&&(!a||a.fid!==u.fid)&&rm(n,u.fid),u}async function ku(n){let e,t=await js(n.appConfig,r=>{let i=xE(r),o=LE(n,i);return e=o.registrationPromise,o.installationEntry});return t.fid===Ru?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function xE(n){let e=n||{fid:PE(),registrationStatus:0};return om(e)}function LE(n,e){if(e.registrationStatus===0){if(!navigator.onLine){let i=Promise.reject(ln.create("app-offline"));return{installationEntry:e,registrationPromise:i}}let t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=ME(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:FE(n)}:{installationEntry:e}}async function ME(n,e){try{let t=await bE(n,e);return Bs(n.appConfig,t)}catch(t){throw Qp(t)&&t.customData.serverCode===409?await sm(n.appConfig):await Bs(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function FE(n){let e=await jp(n.appConfig);for(;e.registrationStatus===1;)await tm(100),e=await jp(n.appConfig);if(e.registrationStatus===0){let{installationEntry:t,registrationPromise:r}=await ku(n);return r||t}return e}function jp(n){return js(n,e=>{if(!e)throw ln.create("installation-not-found");return om(e)})}function om(n){return UE(n)?{fid:n.fid,registrationStatus:0}:n}function UE(n){return n.registrationStatus===1&&n.registrationTime+Wp<Date.now()}async function qE({appConfig:n,heartbeatServiceProvider:e},t){let r=BE(n,t),i=TE(n,t),o=e.getImmediate({optional:!0});if(o){let d=await o.getHeartbeatsHeader();d&&i.append("x-firebase-client",d)}let a={installation:{sdkVersion:Kp,appId:n.appId}},u={method:"POST",headers:i,body:JSON.stringify(a)},h=await em(()=>fetch(r,u));if(h.ok){let d=await h.json();return Yp(d)}else throw await Xp("Generate Auth Token",h)}function BE(n,{fid:e}){return`${Jp(n)}/${e}/authTokens:generate`}async function Du(n,e=!1){let t,r=await js(n.appConfig,o=>{if(!am(o))throw ln.create("not-registered");let a=o.authToken;if(!e&&$E(a))return o;if(a.requestStatus===1)return t=zE(n,e),o;{if(!navigator.onLine)throw ln.create("app-offline");let u=WE(o);return t=jE(n,u),u}});return t?await t:r.authToken}async function zE(n,e){let t=await $p(n.appConfig);for(;t.authToken.requestStatus===1;)await tm(100),t=await $p(n.appConfig);let r=t.authToken;return r.requestStatus===0?Du(n,e):r}function $p(n){return js(n,e=>{if(!am(e))throw ln.create("not-registered");let t=e.authToken;return KE(t)?le(B({},e),{authToken:{requestStatus:0}}):e})}async function jE(n,e){try{let t=await qE(n,e),r=le(B({},e),{authToken:t});return await Bs(n.appConfig,r),t}catch(t){if(Qp(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await sm(n.appConfig);else{let r=le(B({},e),{authToken:{requestStatus:0}});await Bs(n.appConfig,r)}throw t}}function am(n){return n!==void 0&&n.registrationStatus===2}function $E(n){return n.requestStatus===2&&!GE(n)}function GE(n){let e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+yE}function WE(n){let e={requestStatus:1,requestTime:Date.now()};return le(B({},n),{authToken:e})}function KE(n){return n.requestStatus===1&&n.requestTime+Wp<Date.now()}async function HE(n){let e=n,{installationEntry:t,registrationPromise:r}=await ku(e);return r?r.catch(console.error):Du(e).catch(console.error),t.fid}async function QE(n,e=!1){let t=n;return await JE(t),(await Du(t,e)).token}async function JE(n){let{registrationPromise:e}=await ku(n);e&&await e}function YE(n){if(!n||!n.options)throw Su("App Configuration");if(!n.name)throw Su("App Name");let e=["projectId","apiKey","appId"];for(let t of e)if(!n.options[t])throw Su(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Su(n){return ln.create("missing-app-config-values",{valueName:n})}var cm="installations",XE="installations-internal",ZE=n=>{let e=n.getProvider("app").getImmediate(),t=YE(e),r=Me(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},eT=n=>{let e=n.getProvider("app").getImmediate(),t=Me(e,cm).getImmediate();return{getId:()=>HE(t),getToken:i=>QE(t,i)}};function tT(){Re(new de(cm,ZE,"PUBLIC")),Re(new de(XE,eT,"PRIVATE"))}tT();_e(Gp,Pu);_e(Gp,Pu,"esm2020");var $s="analytics",nT="firebase_id",rT="origin",iT=60*1e3,sT="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Fu="https://www.googletagmanager.com/gtag/js";var be=new ze("@firebase/analytics");var oT={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Ve=new De("analytics","Analytics",oT);function aT(n){if(!n.startsWith(Fu)){let e=Ve.create("invalid-gtag-resource",{gtagURL:n});return be.warn(e.message),""}return n}function mm(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function cT(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function uT(n,e){let t=cT("firebase-js-sdk-policy",{createScriptURL:aT}),r=document.createElement("script"),i=`${Fu}?l=${n}&id=${e}`;r.src=t?t?.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function lT(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function hT(n,e,t,r,i,o){let a=r[i];try{if(a)await e[a];else{let h=(await mm(t)).find(d=>d.measurementId===i);h&&await e[h.appId]}}catch(u){be.error(u)}n("config",i,o)}async function dT(n,e,t,r,i){try{let o=[];if(i&&i.send_to){let a=i.send_to;Array.isArray(a)||(a=[a]);let u=await mm(t);for(let h of a){let d=u.find(y=>y.measurementId===h),p=d&&e[d.appId];if(p)o.push(p);else{o=[];break}}}o.length===0&&(o=Object.values(e)),await Promise.all(o),n("event",r,i||{})}catch(o){be.error(o)}}function fT(n,e,t,r){async function i(o,...a){try{if(o==="event"){let[u,h]=a;await dT(n,e,t,u,h)}else if(o==="config"){let[u,h]=a;await hT(n,e,t,r,u,h)}else if(o==="consent"){let[u,h]=a;n("consent",u,h)}else if(o==="get"){let[u,h,d]=a;n("get",u,h,d)}else if(o==="set"){let[u]=a;n("set",u)}else n(o,...a)}catch(u){be.error(u)}}return i}function pT(n,e,t,r,i){let o=function(...a){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(o=window[i]),window[i]=fT(o,n,e,t),{gtagCore:o,wrappedGtag:window[i]}}function mT(n){let e=window.document.getElementsByTagName("script");for(let t of Object.values(e))if(t.src&&t.src.includes(Fu)&&t.src.includes(n))return t;return null}var gT=30,_T=1e3,Vu=class{constructor(e={},t=_T){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}},gm=new Vu;function yT(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function IT(n){let{appId:e,apiKey:t}=n,r={method:"GET",headers:yT(t)},i=sT.replace("{app-id}",e),o=await fetch(i,r);if(o.status!==200&&o.status!==304){let a="";try{let u=await o.json();u.error?.message&&(a=u.error.message)}catch{}throw Ve.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function wT(n,e=gm,t){let{appId:r,apiKey:i,measurementId:o}=n.options;if(!r)throw Ve.create("no-app-id");if(!i){if(o)return{measurementId:o,appId:r};throw Ve.create("no-api-key")}let a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new Ou;return setTimeout(async()=>{u.abort()},t!==void 0?t:iT),_m({appId:r,apiKey:i,measurementId:o},a,u,e)}async function _m(n,{throttleEndTimeMillis:e,backoffCount:t},r,i=gm){let{appId:o,measurementId:a}=n;try{await ET(r,e)}catch(u){if(a)return be.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u?.message}]`),{appId:o,measurementId:a};throw u}try{let u=await IT(n);return i.deleteThrottleMetadata(o),u}catch(u){let h=u;if(!TT(h)){if(i.deleteThrottleMetadata(o),a)return be.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:o,measurementId:a};throw u}let d=Number(h?.customData?.httpStatus)===503?Ao(t,i.intervalMillis,gT):Ao(t,i.intervalMillis),p={throttleEndTimeMillis:Date.now()+d,backoffCount:t+1};return i.setThrottleMetadata(o,p),be.debug(`Calling attemptFetch again in ${d} millis`),_m(n,p,r,i)}}function ET(n,e){return new Promise((t,r)=>{let i=Math.max(e-Date.now(),0),o=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(o),r(Ve.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function TT(n){if(!(n instanceof ge)||!n.customData)return!1;let e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}var Ou=class{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};var xu;async function vT(n,e,t,r,i){if(i&&i.global){n("event",t,r);return}else{let o=await e,a=le(B({},r),{send_to:o});n("event",t,a)}}async function AT(n,e,t,r){if(r&&r.global){let i={};for(let o of Object.keys(t))i[`user_properties.${o}`]=t[o];return n("set",i),Promise.resolve()}else{let i=await e;n("config",i,{update:!0,user_properties:t})}}var Lu;function bT(n){Lu=n}function ST(n){xu=n}async function RT(){if(lr())try{await gi()}catch(n){return be.warn(Ve.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return be.warn(Ve.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function PT(n,e,t,r,i,o,a){let u=wT(n);u.then(T=>{t[T.measurementId]=T.appId,n.options.measurementId&&T.measurementId!==n.options.measurementId&&be.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${T.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(T=>be.error(T)),e.push(u);let h=RT().then(T=>{if(T)return r.getId()}),[d,p]=await Promise.all([u,h]);mT(o)||uT(o,d.measurementId),Lu&&(i("consent","default",Lu),bT(void 0)),i("js",new Date);let y=a?.config??{};return y[rT]="firebase",y.update=!0,p!=null&&(y[nT]=p),i("config",d.measurementId,y),xu&&(i("set",xu),ST(void 0)),d.measurementId}var Mu=class{constructor(e){this.app=e}_delete(){return delete $n[this.app.options.appId],Promise.resolve()}},$n={},um=[],lm={},Nu="dataLayer",CT="gtag",hm,Uu,dm=!1;function kT(){let n=[];if(mi()&&n.push("This is a browser extension environment."),ih()||n.push("Cookies are not available."),n.length>0){let e=n.map((r,i)=>`(${i+1}) ${r}`).join(" "),t=Ve.create("invalid-analytics-context",{errorInfo:e});be.warn(t.message)}}function DT(n,e,t){kT();let r=n.options.appId;if(!r)throw Ve.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)be.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Ve.create("no-api-key");if($n[r]!=null)throw Ve.create("already-exists",{id:r});if(!dm){lT(Nu);let{wrappedGtag:o,gtagCore:a}=pT($n,um,lm,Nu,CT);Uu=o,hm=a,dm=!0}return $n[r]=PT(n,um,lm,e,hm,Nu,t),new Mu(n)}function ym(n=Ut()){n=ne(n);let e=Me(n,$s);return e.isInitialized()?e.getImmediate():NT(n)}function NT(n,e={}){let t=Me(n,$s);if(t.isInitialized()){let i=t.getImmediate();if(Ne(e,t.getOptions()))return i;throw Ve.create("already-initialized")}return t.initialize({options:e})}function VT(n,e,t){n=ne(n),AT(Uu,$n[n.app.options.appId],e,t).catch(r=>be.error(r))}function OT(n,e,t,r){n=ne(n),vT(Uu,$n[n.app.options.appId],e,t,r).catch(i=>be.error(i))}var fm="@firebase/analytics",pm="0.10.19";function xT(){Re(new de($s,(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return DT(r,i,t)},"PUBLIC")),Re(new de("analytics-internal",n,"PRIVATE")),_e(fm,pm),_e(fm,pm,"esm2020");function n(e){try{let t=e.getProvider($s).getImmediate();return{logEvent:(r,i,o)=>OT(t,r,i,o),setUserProperties:(r,i)=>VT(t,r,i)}}catch(t){throw Ve.create("interop-component-reg-failed",{reason:t})}}}xT();var LT=ui.firebase,Im=Uo(LT),Gn=Ia(Im),kS=ym(Im);var wm=class n{constructor(e){this.router=e}apiUrl=ui.apiUrl;currentUser=_o(null);userRole=_o(null);db=vu();authInitialized=new Promise(e=>{let t=Ui(Gn,async r=>{if(this.currentUser.set(r),r){let i=await this.getUserRole(r.uid);this.userRole.set(i)}else this.userRole.set(null);e(),t()});Ui(Gn,async r=>{if(this.currentUser.set(r),r){let i=await this.getUserRole(r.uid);this.userRole.set(i)}else this.userRole.set(null)})});async register(e,t,r,i,o=""){try{let a=await pa(Gn,e,t);return await ga(a.user,{displayName:r}),await this.saveUserRole(a.user.uid,i,r,e,o),this.userRole.set(i),a.user}catch(a){throw a}}async login(e,t){try{let r=await ma(Gn,e,t),i=await this.getUserRole(r.user.uid);return i||(console.log("User has no role, defaulting to buyer"),i="buyer",await this.saveUserRole(r.user.uid,i,r.user.displayName||"User",r.user.email||e)),this.userRole.set(i),i==="buyer"?this.router.navigate(["/buyer"]):i==="vendor"?this.router.navigate(["/vendor"]):i==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/"]),r.user}catch(r){throw r}}async logout(){await _a(Gn),this.userRole.set(null),this.router.navigate(["/"])}async saveUserRole(e,t,r,i,o=""){let a=Gr(this.db,"users",e),u={uid:e,role:t,displayName:r,email:i,createdAt:new Date};o&&(u.plan=o,o==="trial"&&(u.trialStartDate=new Date,u.quotesResponded=0)),await zp(a,u,{merge:!0})}async getUserRole(e){let t=Gr(this.db,"users",e),r=await Bp(t);return r.exists()?r.data().role:null}static \u0275fac=function(t){return new(t||n)(jl($l))};static \u0275prov=zl({token:n,factory:n.\u0275fac,providedIn:"root"})};export{wm as a};
